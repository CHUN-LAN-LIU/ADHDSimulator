<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å·¥ä½œè®°å¿†æ³„æ¼æ¨¡æ‹Ÿå™¨ (ADHD Simulator)</title>
    <style>
        :root {
            --primary-color: #0052cc;
            --error-color: #ff3b30;
            --bg-color: #f5f7fa;
            --card-bg: #ffffff;
            --text-color: #172b4d;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            color: var(--text-color);
        }

        /* æ¨¡æ‹Ÿæ‰‹æœºé“¶è¡Œç•Œé¢å®¹å™¨ */
        .app-container {
            width: 375px;
            height: 700px;
            background: var(--card-bg);
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.15);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            position: relative;
        }

        /* é¡¶éƒ¨å¯¼èˆª */
        .header {
            padding: 20px;
            text-align: center;
            font-weight: 600;
            border-bottom: 1px solid #eee;
            background: #fff;
            z-index: 10;
        }

        /* æ ¸å¿ƒåŒºåŸŸï¼šæºæ•°æ® (Source) */
        .source-section {
            padding: 30px 20px;
            background: #eef1f5;
            cursor: pointer; /* æš—ç¤ºè¿™æ˜¯å¯äº¤äº’åŒºåŸŸ */
            transition: all 0.2s;
            position: relative;
        }

        .source-label {
            font-size: 12px;
            color: #6b778c;
            margin-bottom: 8px;
            display: flex;
            justify-content: space-between;
        }

        .card-number-display {
            font-family: 'Courier New', Courier, monospace;
            font-size: 24px;
            font-weight: 700;
            letter-spacing: 2px;
            color: #091e42;
            padding: 15px;
            background: #fff;
            border-radius: 8px;
            border: 1px solid #dfe1e6;
            text-align: center;
            transition: filter 0.1s ease; /* æé€Ÿåˆ‡æ¢ */
        }

        /* é©¬èµ›å…‹æ¨¡ç³Šæ•ˆæœ - æ¨¡æ‹Ÿæ— æ³•é€šè¿‡ä½™å…‰çœ‹æ¸… */
        .mosaic-blur {
            filter: blur(12px);
            user-select: none;
            opacity: 0.6;
        }

        /* æç¤ºå±‚ */
        .blur-hint {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 14px;
            color: #666;
            opacity: 0;
            pointer-events: none;
            font-weight: bold;
        }
        .mosaic-blur + .blur-hint {
            opacity: 1;
        }

        /* è¾“å…¥åŒºåŸŸ (Target) */
        .input-section {
            padding: 40px 20px;
            flex-grow: 1;
        }

        .input-group {
            position: relative;
        }

        .input-field {
            width: 100%;
            padding: 16px;
            font-size: 20px;
            border: 2px solid #dfe1e6;
            border-radius: 8px;
            outline: none;
            box-sizing: border-box;
            letter-spacing: 3px;
            transition: border-color 0.2s, opacity 0.5s; /* opacity ç”¨äºè¡°å‡åŠ¨ç”» */
        }

        .input-field:focus {
            border-color: var(--primary-color);
        }

        /* è®°å¿†è¡°å‡æ•ˆæœ */
        .fading {
            color: transparent;
            text-shadow: 0 0 10px rgba(0,0,0,0.1); /* å˜å¾—æ¨¡ç³Šä¸å¯è¯» */
            opacity: 0.2;
        }

        /* é”™è¯¯åé¦ˆåŠ¨ç”» (Shake) */
        .shake {
            animation: shake 0.5s cubic-bezier(.36,.07,.19,.97) both;
            border-color: var(--error-color) !important;
            background-color: #fff5f5;
        }

        @keyframes shake {
            10%, 90% { transform: translate3d(-1px, 0, 0); }
            20%, 80% { transform: translate3d(2px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-4px, 0, 0); }
            40%, 60% { transform: translate3d(4px, 0, 0); }
        }

        /* ç»Ÿè®¡é¢æ¿ */
        .stats-panel {
            margin-top: 30px;
            padding: 15px;
            background: #fff0b3; /* è­¦ç¤ºé»„ */
            border-radius: 8px;
            font-size: 13px;
            color: #172b4d;
            line-height: 1.6;
        }

        .stat-highlight {
            font-weight: bold;
            color: var(--error-color);
            font-size: 16px;
        }

        .memory-bar-container {
            height: 4px;
            background: #eee;
            margin-top: 10px;
            border-radius: 2px;
            overflow: hidden;
        }
        
        .memory-bar {
            height: 100%;
            width: 100%;
            background: #36b37e;
            transform-origin: left;
            transition: width 0.1s linear;
        }

        /* æŒ‰é’® */
        .btn-submit {
            margin-top: auto;
            width: 100%;
            padding: 15px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            opacity: 0.5;
            pointer-events: none;
        }
        .btn-submit.active {
            opacity: 1;
            pointer-events: auto;
        }

    </style>
</head>
<body>

    <div class="app-container">
        <div class="header">è½¬è´¦æ±‡æ¬¾</div>

        <div class="source-section" id="sourceArea">
            <div class="source-label">
                <span>å¯¹æ–¹å¡å·</span>
                <span>ğŸ‘€ çœ‹ç€è¿™é‡Œä»¥è®°å¿†</span>
            </div>
            <div class="card-number-display" id="sourceNumber">6222021009881234</div>
            
        </div>

        <div class="input-section">
            <div class="source-label">è¾“å…¥å¡å·</div>
            <div class="input-group">
                <input type="number" class="input-field" id="inputField" placeholder="åœ¨æ­¤è¾“å…¥å¡å·">
                <div class="memory-bar-container">
                    <div class="memory-bar" id="memoryBar"></div>
                </div>
            </div>

            <div class="stats-panel">
                <div>ğŸ’¥ è®°å¿†é‡ç½®æ¬¡æ•°ï¼š<span class="stat-highlight" id="resetCount">0</span> æ¬¡</div>
                <div>ğŸ“‰ å½“å‰è®°å¿†çŠ¶æ€ï¼š<span id="memoryStatus">ç©ºé—²</span></div>
                <div style="margin-top:5px; font-size:11px; color:#666;">*åªè¦é‡æ–°æŸ¥çœ‹ä¸Šæ–¹å¡å·ï¼Œè¾“å…¥æ¡†å°†ç«‹å³æ¸…ç©ºã€‚</div>
            </div>
            
            <button class="btn-submit" id="submitBtn">ç¡®è®¤è½¬è´¦</button>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒå˜é‡ ---
        const TARGET_NUMBER = "6222021009881234";
        let resetCounter = 0;
        let decayTimer = null;
        let isDecaying = false;
        
        // --- DOM å…ƒç´  ---
        const sourceArea = document.getElementById('sourceArea');
        const sourceNumber = document.getElementById('sourceNumber');
        const inputField = document.getElementById('inputField');
        const resetCountDisplay = document.getElementById('resetCount');
        const memoryStatus = document.getElementById('memoryStatus');
        const memoryBar = document.getElementById('memoryBar');
        const submitBtn = document.getElementById('submitBtn');

        // --- 1. äº’æ–¥è§†é‡é€»è¾‘ (The Mutually Exclusive View) ---

        // å½“ç”¨æˆ·ç‚¹å‡»æˆ–èšç„¦è¾“å…¥æ¡† -> ä¸Šæ–¹æ¨¡ç³Š (æ‰§è¡Œæ¨¡å¼)
        inputField.addEventListener('focus', () => {
            enterExecutionMode();
        });

        // å½“ç”¨æˆ·æƒ³è¦çœ‹ä¸Šæ–¹å¡å· (é¼ æ ‡ç§»å…¥/ç‚¹å‡») -> ä¸‹æ–¹æ¸…ç©º (è§‚å¯Ÿæ¨¡å¼)
        // æ¨¡æ‹Ÿï¼šä¸ºäº†"çœ‹æ¸…"ï¼Œè¢«è¿«æ”¾å¼ƒ"æ‰‹å¤´æ­£åœ¨åšçš„äº‹"
        sourceArea.addEventListener('mouseenter', () => {
            // åªæœ‰å½“è¾“å…¥æ¡†æœ‰å†…å®¹ï¼Œä¸”å½“å‰å¤„äº"æ¨¡ç³Š"çŠ¶æ€æ—¶ï¼Œæ‰è§¦å‘æƒ©ç½š
            if (inputField.value.length > 0 && sourceNumber.classList.contains('mosaic-blur')) {
                triggerMemoryLeak();
            }
            enterObservationMode();
        });

        // ç§»åŠ¨ç«¯å…¼å®¹ (è§¦æ‘¸)
        sourceArea.addEventListener('touchstart', () => {
             if (inputField.value.length > 0 && sourceNumber.classList.contains('mosaic-blur')) {
                triggerMemoryLeak();
            }
            enterObservationMode();
        });

        function enterExecutionMode() {
            sourceNumber.classList.add('mosaic-blur');
            memoryStatus.innerText = "âš¡ æ‰§è¡Œä¸­ (è®°å¿†æ­£åœ¨è¡°å‡...)";
            startDecay(); // å¼€å§‹å€’è®¡æ—¶
        }

        function enterObservationMode() {
            sourceNumber.classList.remove('mosaic-blur');
            stopDecay(); // åœæ­¢è¡°å‡
            memoryStatus.innerText = "ğŸ‘ï¸ è§‚å¯Ÿä¸­ (æ— æ³•è¾“å…¥)";
            inputField.blur(); // å¤±å»ç„¦ç‚¹
        }

        // --- 2. å†…å­˜æ³„æ¼æƒ©ç½š (Memory Leak Event) ---
        function triggerMemoryLeak() {
            // åªæœ‰ç¡®å®æœ‰è¾“å…¥å†…å®¹æ‰ç®—"æ³„æ¼"
            resetCounter++;
            resetCountDisplay.innerText = resetCounter;
            
            // è§†è§‰ç‰¹æ•ˆï¼šè¾“å…¥æ¡†æ¸…ç©º + éœ‡åŠ¨
            inputField.value = ""; 
            inputField.classList.add('shake');
            
            // éŸ³æ•ˆæ¨¡æ‹Ÿ (å¯é€‰ï¼Œæ­¤å¤„ä»…ç”¨è§†è§‰)
            // playGlitchSound();

            setTimeout(() => {
                inputField.classList.remove('shake');
            }, 500);
        }

        // --- 3. æ€¥é€Ÿè¡°å‡é€»è¾‘ (Rapid Decay) ---
        // æ¨¡æ‹Ÿï¼šå¦‚æœä¸æŒç»­åˆ·æ–°(æ‰“å­—)ï¼Œè®°å¿†åœ¨1.5ç§’åå¼€å§‹æ¶ˆå¤±
        
        inputField.addEventListener('input', () => {
            // æ¯æ¬¡è¾“å…¥ï¼Œé‡ç½®è¡°å‡è®¡æ—¶å™¨ (åˆ·æ–°è®°å¿†)
            inputField.classList.remove('fading');
            resetDecayTimer();
            
            // æ£€æŸ¥å®Œæˆåº¦
            if(inputField.value === TARGET_NUMBER) {
                submitBtn.classList.add('active');
                submitBtn.innerText = "ç»ˆäºå®Œæˆäº†ï¼(ç‚¹å‡»æäº¤)";
                stopDecay();
            } else {
                submitBtn.classList.remove('active');
            }
        });

        function startDecay() {
            memoryBar.style.width = '100%';
            memoryBar.style.backgroundColor = '#36b37e'; // Green
            
            // æ¨¡æ‹Ÿèƒ½é‡æ¡å€’è®¡æ—¶
            let width = 100;
            clearInterval(decayTimer);
            
            decayTimer = setInterval(() => {
                width -= 2; // çº¦1.5ç§’è·‘å®Œå‰æ®µ
                memoryBar.style.width = width + '%';
                
                if (width < 60) memoryBar.style.backgroundColor = '#ffab00'; // Yellow
                if (width < 30) memoryBar.style.backgroundColor = '#ff3b30'; // Red

                // 1.5ç§’åå¼€å§‹æ–‡å­—æ¸éš (å‡è®¾50msåˆ·æ–°ä¸€æ¬¡, 50 * 30 = 1500ms)
                if (width < 50) {
                    inputField.classList.add('fading');
                }
                
                // 3ç§’è€—å°½
                if (width <= 0) {
                    clearInterval(decayTimer);
                    // å½»åº•å¿˜è®°ï¼šå¯é€‰é€»è¾‘æ˜¯æ¸…ç©ºï¼Œæˆ–è€…æ˜¯å˜å¾—å®Œå…¨é€æ˜
                    inputField.value = ""; // æ®‹å¿æ¨¡å¼ï¼šç›´æ¥ä¸¢äº†
                    inputField.classList.remove('fading');
                    memoryStatus.innerText = "âŒ è®°å¿†å·²ä¸¢å¤± (è¶…æ—¶)";
                }
            }, 50); // 50ms interval
        }

        function resetDecayTimer() {
            clearInterval(decayTimer);
            startDecay();
        }

        function stopDecay() {
            clearInterval(decayTimer);
            memoryBar.style.width = '100%';
            inputField.classList.remove('fading');
        }

    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ADHD æ¨¡æ‹Ÿï¼šå¤±æ•ˆçš„è¿‡æ»¤å™¨</title>
    <style>
        /* ==================== 
           CSS éƒ¨åˆ†ï¼šè´Ÿè´£è§†è§‰æ ·å¼ 
           ==================== */
        
        /* åŸºç¡€é‡ç½® */
        body {
            margin: 0;
            padding: 0;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #f4f4f4;
            height: 100vh;
            overflow: hidden; /* ç¦æ­¢æ»šåŠ¨ï¼Œå¼ºåˆ¶æ²‰æµ¸ */
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }

        /* 1. æ¨¡æ‹Ÿâ€œå¼€å§‹é¡µé¢â€ - è§£å†³æµè§ˆå™¨ç¦æ­¢è‡ªåŠ¨æ’­æ”¾éŸ³é¢‘çš„é—®é¢˜ */
        #start-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            color: #fff;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            cursor: pointer;
            flex-direction: column;
        }

        /*   2. æ ¸å¿ƒå·¥ä½œåŒºï¼šæ”¹ç­¾æ”¿ç­–é˜…è¯»åŒº   */
        #main-container {
            width: 600px;
            background: white;
            padding: 40px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            border-radius: 8px;
            position: relative;
            z-index: 10;
            transition: filter 0.2s; /* è®©æ¨¡ç³Šå˜åŒ–é¡ºæ»‘ä¸€ç‚¹ */
        }

        h2 { margin-top: 0; color: #0056b3; }
        
        /* è¿™é‡Œçš„ transition å†³å®šäº†æ¨¡ç³Šæ˜¯æ¸å˜è¿˜æ˜¯çªå˜ */
        #text-content {
            font-size: 16px;
            line-height: 1.8;
            color: #444;
            /* å…³é”®ï¼šå…è®¸æˆ‘ä»¬åœ¨JSé‡Œä¿®æ”¹ filter å±æ€§ */
            filter: blur(0px); 
            will-change: filter;
        }

        .highlight-code {
            font-weight: bold;
            background: #eee;
            padding: 2px 5px;
        }

        /* è¾“å…¥æ¡†åŒºåŸŸ */
        .input-area {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        input {
            padding: 10px;
            width: 200px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        /* 3. å¹²æ‰°ç‰©ï¼šä¾§è¾¹æ å¹¿å‘Š */
        /* åˆå§‹çŠ¶æ€ï¼šçœ‹èµ·æ¥å¾ˆæ­£å¸¸ï¼Œåªæ˜¯ä¸€ä¸ªå°å¹¿å‘Š */
        .distraction {
            position: absolute;
            width: 120px;
            height: 120px;
            background: #fff;
            border: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }

        /* å¹²æ‰°ç‰©ä½ç½® */
        #ad-left { top: 20%; left: 10%; }
        #ad-right { bottom: 20%; right: 10%; }

        /* === ç—…ç†çŠ¶æ€ CSS === */

        /* çŠ¶æ€ï¼šé«˜äº®å¹²æ‰° (Distraction Salience) */
        /* å½“è¿™ä¸ªç±»è¢«JSåŠ ä¸Šæ—¶ï¼Œå¹¿å‘Šå˜æˆéœ“è™¹è‰² */
        .distraction.active {
            background-color: #ff00ff; /* åˆºçœ¼çš„æ´‹çº¢ */
            color: yellow;
            border: 3px solid yellow;
            z-index: 100; /* æµ®åˆ°æœ€ä¸Šå±‚ */
            font-weight: bold;
            font-size: 14px;
            /* ç»‘å®šçš„åŠ¨ç”»ï¼šç–¯ç‹‚æŠ–åŠ¨ */
            animation: jitter 0.2s infinite; 
            box-shadow: 0 0 20px #ff00ff;
        }

        /* åŠ¨ç”»å…³é”®å¸§ï¼šæ¨¡æ‹ŸæŠ–åŠ¨ (Jitter) */
        @keyframes jitter {
            0% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(2px, 2px) rotate(2deg); }
            50% { transform: translate(-2px, -2px) rotate(-2deg); }
            75% { transform: translate(-2px, 2px) rotate(1deg); }
            100% { transform: translate(0, 0) rotate(0deg); }
        }

        /* 4. è¯Šæ–­ç»“æœè¦†ç›–å±‚ */
        #diagnosis-overlay {
            display: none; /* é»˜è®¤éšè— */
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(20, 20, 20, 0.95);
            color: #0f0; /* é»‘å®¢å¸å›½é£æ ¼ç»¿å­—ï¼Œæ¨¡æ‹ŸåŒ»å­¦ä»ªå™¨ */
            font-family: 'Courier New', Courier, monospace;
            z-index: 10000;
            padding: 40px;
            box-sizing: border-box;
            overflow-y: auto;
        }
        .diag-title { font-size: 24px; border-bottom: 2px solid #0f0; padding-bottom: 10px; margin-bottom: 20px;}
        .diag-content { font-size: 16px; line-height: 1.6; max-width: 800px; margin: 0 auto;}

    </style>
</head>
<body>

    <div id="start-overlay" onclick="startSimulation()">
        <h1>ADHD æ¨¡æ‹Ÿå®éªŒ No.1</h1>
        <p>è¯·ä½©æˆ´è€³æœºä»¥è·å¾—æœ€ä½³ä½“éªŒ</p>
        <p>[ ç‚¹å‡»å±å¹•å¼€å§‹ ]</p>
    </div>

    <div id="ad-left" class="distraction">
        <span>âœˆï¸ ç‰¹ä»·æœºç¥¨</span>
        <span>ä»…éœ€ Â¥99</span>
    </div>

    <div id="ad-right" class="distraction">
        <span>ğŸ‘©â€ğŸ’¼ åœ¨çº¿å®¢æœ</span>
        <span>æœ‰ç–‘é—®ç‚¹æˆ‘</span>
    </div>

    <div id="main-container">
        <h2>èˆªç­æ”¹ç­¾æ”¿ç­–è¯´æ˜</h2>
        <div id="text-content">
            <p>å°Šæ•¬çš„æ—…å®¢ï¼Œç”±äºç©ºåŸŸæµé‡æ§åˆ¶ï¼Œæ‚¨çš„èˆªç­ CA1234 é¢„è®¡å»¶è¯¯ 4 å°æ—¶ã€‚æ ¹æ®ã€Šæ°‘èˆªæ—…å®¢æœåŠ¡æ ‡å‡†ã€‹ï¼Œæ‚¨æœ‰æƒç”³è¯·å…è´¹éè‡ªæ„¿æ”¹ç­¾ã€‚</p>
            <p>è¯·æ³¨æ„ï¼šæ”¹ç­¾çª—å£æœŸä»…ä¸ºèµ·é£å‰ 45 åˆ†é’Ÿã€‚è‹¥éœ€åŠç†ï¼Œè¯·ç™»å½•è‡ªåŠ©ç»ˆç«¯ã€‚åœ¨éªŒè¯ç¯èŠ‚ï¼Œç³»ç»Ÿå°†è¦æ±‚æ‚¨è¾“å…¥æœ¬æ¬¡èˆªç­çš„ä¸“å±æ”¹ç­¾éªŒè¯ç ã€‚è¯·ä»”ç»†æ ¸å¯¹ä»¥ä¸‹ä¿¡æ¯ï¼š</p>
            <p>æ‚¨çš„æ”¹ç­¾éªŒè¯ç ä¸ºï¼š<span class="highlight-code">XJ9-TR</span>ã€‚è¯·åŠ¡å¿…åœ¨ä¸‹æ–¹è¾“å…¥æ¡†ä¸­å‡†ç¡®å¡«å†™è¯¥ä»£ç ä»¥é”å®šæ–°åº§ä½ã€‚å¦‚é‡éªŒè¯ç å¤±æ•ˆï¼Œè¯·è”ç³»åœ°å‹¤äººå‘˜ã€‚</p>
            <p>æ³¨æ„ï¼šä»»ä½•æ‰‹è¯¯éƒ½å¯èƒ½å¯¼è‡´åº§ä½è¢«é‡Šæ”¾ã€‚</p>
        </div>
        
        <div class="input-area">
            <label>è¯·è¾“å…¥éªŒè¯ç ï¼š</label>
            <input type="text" placeholder="åœ¨æ­¤è¾“å…¥..." id="verify-input">
        </div>
    </div>

    <div id="diagnosis-overlay">
        <div class="diag-content">
            <div class="diag-title">ğŸ§  è¯Šæ–­æŠ¥å‘Šï¼šæ„Ÿå®˜é—¨æ§å¤±æ•ˆ (Sensory Gating Failure)</div>
            <p><strong>å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ</strong><br>æ‚¨åˆšæ‰çš„ä½“éªŒï¼Œæ¨¡æ‹Ÿäº† ADHD æ‚£è€…å‰é¢å¶çš®å±‚æ— æ³•æ‰§è¡Œâ€œè‡ªä¸Šè€Œä¸‹çš„å¤„ç†â€æ—¶çš„çŠ¶æ€ã€‚</p>
            <p><strong>æ ¸å¿ƒæœºåˆ¶è§£æï¼š</strong><br>æ™®é€šäººçš„å¤§è„‘æ‹¥æœ‰â€œé¸¡å°¾é…’ä¼šæ•ˆåº”â€ï¼Œèƒ½è‡ªåŠ¨å±è”½èƒŒæ™¯å™ªéŸ³ã€‚ä½†åˆšæ‰ï¼Œæ‚¨çš„â€œå¤§è„‘æ»¤ç½‘â€ç ´æŸäº†ã€‚æ¯ä¸€æ¬¡å’–å•¡é¦†çš„æ¯å­ç¢°æ’å£°ã€æ¯ä¸€æ¬¡è¾¹ç¼˜çš„é—ªçƒï¼Œéƒ½è¢«æ‚¨çš„å¤§è„‘æ ‡è®°ä¸ºâ€œæœ€é«˜ä¼˜å…ˆçº§â€ã€‚</p>
            <p><strong>æ•°æ®ç»Ÿè®¡ï¼š</strong><br>ä¸ºäº†çœ‹æ¸…è¿™ 150 ä¸ªå­—ï¼Œæ‚¨è¢«è¿«å¤„ç†äº† <span id="distraction-count">0</span> æ¬¡æ— å…³å¹²æ‰°ã€‚</p>
            <p>è¿™å°±æ˜¯ä¸ºä»€ä¹ˆ ADHD æ‚£è€…åœ¨åšç®€å•å·¥ä½œæ—¶ï¼Œå´ä¼šæ„Ÿåˆ°æåº¦ç–²æƒ«ã€‚</p>
            <br>
            <button onclick="location.reload()" style="padding:10px; cursor:pointer;">é‡æ–°ä½“éªŒ</button>
        </div>
    </div>

    <script>
        /* ==================== 
           JS éƒ¨åˆ†ï¼šé€»è¾‘æ ¸å¿ƒ 
           ==================== */

        // å…¨å±€å˜é‡é…ç½®
        const CONFIG = {
            blurSpeed: 0.05,       // æ¨¡ç³Šå¢åŠ çš„é€Ÿåº¦ (è¶Šå¤§è¶Šå¿«)
            maxBlur: 8,            // æœ€å¤§æ¨¡ç³Šåƒç´ 
            triggerThreshold: 4,   // æ¨¡ç³Šè¾¾åˆ°å¤šå°‘æ—¶ï¼Œè§¦å‘å¼ºè¡Œå¹²æ‰°
            noiseBaseVolume: 0.1,  // èƒŒæ™¯ç™½å™ªéŸ³åŸºç¡€éŸ³é‡
        };

        // çŠ¶æ€å˜é‡
        let state = {
            isStarted: false,
            currentBlur: 0,
            isFocusingText: false, // é¼ æ ‡æ˜¯å¦åœ¨çœ‹æ–‡å­—
            distractionActive: false, // æ˜¯å¦è¿›å…¥äº†â€œå¼ºåˆ¶å¹²æ‰°æ¨¡å¼â€
            failCount: 0,          // å¤±è´¥ï¼ˆè¢«è¿«å»ç‚¹å¹¿å‘Šï¼‰çš„æ¬¡æ•°
            audioContext: null     // éŸ³é¢‘ä¸Šä¸‹æ–‡
        };

        // è·å– DOM å…ƒç´  (å°±åƒ document.getElementById çš„ç®€åŒ–ç‰ˆ)
        const textContent = document.getElementById('text-content');
        const distractions = document.querySelectorAll('.distraction');
        const startOverlay = document.getElementById('start-overlay');
        const diagOverlay = document.getElementById('diagnosis-overlay');
        const distCountSpan = document.getElementById('distraction-count');

        // === 1. éŸ³é¢‘å¼•æ“ (Web Audio API) ===
        // è¿™é‡Œæˆ‘ä»¬ç”¨ä»£ç â€œåˆæˆâ€å£°éŸ³ï¼Œè¿™æ ·ä½ ä»¬å°±ä¸éœ€è¦æ‰¾ mp3 æ–‡ä»¶äº†
        
        let whiteNoiseNode = null; // ç™½å™ªéŸ³å‘ç”Ÿå™¨
        let oscillator = null;     // å°–é”å™ªéŸ³å‘ç”Ÿå™¨
        let panner = null;         // 3D ç¯ç»•æ§åˆ¶å™¨

        function initAudio() {
            // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡ï¼ˆç›¸å½“äºæ‰“å¼€éŸ³å“ç”µæºï¼‰
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            state.audioContext = new AudioContext();

            // --- A. åˆ›å»ºç™½å™ªéŸ³ (èƒŒæ™¯ç¯å¢ƒéŸ³) ---
            const bufferSize = 2 * state.audioContext.sampleRate;
            const noiseBuffer = state.audioContext.createBuffer(1, bufferSize, state.audioContext.sampleRate);
            const output = noiseBuffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) {
                // ç”Ÿæˆéšæœºæ•°æ¨¡æ‹Ÿæ²™æ²™å£°
                output[i] = Math.random() * 2 - 1;
            }
            whiteNoiseNode = state.audioContext.createBufferSource();
            whiteNoiseNode.buffer = noiseBuffer;
            whiteNoiseNode.loop = true;
            
            // éŸ³é‡æ§åˆ¶
            const gainNode = state.audioContext.createGain();
            gainNode.gain.value = CONFIG.noiseBaseVolume; 
            whiteNoiseNode.connect(gainNode);
            gainNode.connect(state.audioContext.destination);
            whiteNoiseNode.start();

            // --- B. åˆ›å»ºå°–é”å™ªéŸ³ (å¹²æ‰°éŸ³) ---
            // æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæŒ¯è¡å™¨ï¼Œä½†å…ˆä¸è¿ä¸Šå–‡å­ï¼Œç­‰éœ€è¦å¹²æ‰°æ—¶å†è¿
            // è¿™é‡Œä¸ºäº†ç®€å•ï¼Œæˆ‘ä»¬ç”¨ä¸€ä¸ªå‡½æ•°åŠ¨æ€åˆ›å»º
        }

        // æ’­æ”¾å°–é”çš„å¹²æ‰°éŸ³ (æ»´æ»´æ»´çš„å£°éŸ³)
        function playDistractionSound(intensity) {
            if (!state.audioContext) return;
            
            const osc = state.audioContext.createOscillator();
            const gain = state.audioContext.createGain();
            const pan = state.audioContext.createStereoPanner();

            osc.type = 'sawtooth'; // é”¯é½¿æ³¢ï¼Œå¬èµ·æ¥æ¯”è¾ƒåˆºè€³
            // éŸ³è°ƒéšæ¨¡ç³Šç¨‹åº¦å˜é«˜ (300Hz -> 800Hz)
            osc.frequency.value = 300 + (intensity * 100); 

            // å·¦å³å£°é“éšæœºæ¸¸èµ° (-1 æ˜¯å·¦è€³, 1 æ˜¯å³è€³)
            pan.pan.value = Math.sin(Date.now() / 500); 

            // éŸ³é‡
            gain.gain.value = 0.05 * intensity; 

            // è¿æ¥çº¿è·¯: å‘ç”Ÿå™¨ -> å·¦å³æ§åˆ¶ -> éŸ³é‡æ§åˆ¶ -> è€³æœº
            osc.connect(pan);
            pan.connect(gain);
            gain.connect(state.audioContext.destination);

            osc.start();
            // 0.1ç§’ååœæ­¢ï¼ˆæ¨¡æ‹ŸçŸ­ä¿ƒçš„â€œå˜Ÿâ€å£°ï¼‰
            osc.stop(state.audioContext.currentTime + 0.1);
        }

        // === 2. æ ¸å¿ƒé€»è¾‘å¾ªç¯ (Game Loop) ===
        // è¿™ä¸ªå‡½æ•°æ¯ç§’è¿è¡Œ 60 æ¬¡ï¼Œè´Ÿè´£æ›´æ–°ç”»é¢
        function loop() {
            if (!state.isStarted) return requestAnimationFrame(loop);

            // é€»è¾‘ A: å¦‚æœé¼ æ ‡åœ¨çœ‹æ–‡å­—ï¼Œä¸”æ²¡æœ‰å¤„äºå¹²æ‰°å†·å´æœŸ
            if (state.isFocusingText && !state.distractionActive) {
                // æ¨¡ç³Šåº¦å¢åŠ 
                state.currentBlur += CONFIG.blurSpeed;
                
                // æ’­æ”¾éšæœºçš„å¹²æ‰°éŸ³ (æ¨¡ç³Šåº¦è¶Šé«˜ï¼Œå¹²æ‰°è¶Šé¢‘ç¹)
                if (Math.random() < (state.currentBlur * 0.01)) {
                    playDistractionSound(state.currentBlur);
                }
            } 
            // é€»è¾‘ B: å¦‚æœä¸åœ¨çœ‹æ–‡å­—ï¼Œæ¨¡ç³Šåº¦ç¼“æ…¢æ¢å¤
            else if (!state.distractionActive) {
                if (state.currentBlur > 0) state.currentBlur -= 0.1;
                if (state.currentBlur < 0) state.currentBlur = 0;
            }

            // åº”ç”¨æ¨¡ç³Šæ ·å¼åˆ°æ–‡å­—ä¸Š
            textContent.style.filter = `blur(${state.currentBlur}px)`;

            // é€»è¾‘ C: è§¦å‘å¼ºè¡Œå¹²æ‰°
            if (state.currentBlur > CONFIG.triggerThreshold && !state.distractionActive) {
                triggerDistractionMode();
            }

            // ç»§ç»­ä¸‹ä¸€å¸§
            requestAnimationFrame(loop);
        }

        // === 3. äº¤äº’æ§åˆ¶ ===

        function startSimulation() {
            state.isStarted = true;
            startOverlay.style.display = 'none';
            initAudio(); // åªæœ‰ç‚¹å‡»åæ‰èƒ½æ’­æ”¾å£°éŸ³
            loop(); // å¯åŠ¨å¾ªç¯
        }

        // ç›‘å¬ï¼šé¼ æ ‡ç§»å…¥æ–‡å­—åŒº
        document.getElementById('main-container').addEventListener('mouseenter', () => {
            state.isFocusingText = true;
        });
        // ç›‘å¬ï¼šé¼ æ ‡ç§»å‡ºæ–‡å­—åŒº
        document.getElementById('main-container').addEventListener('mouseleave', () => {
            state.isFocusingText = false;
        });

        // è§¦å‘å¹²æ‰°æ¨¡å¼
        function triggerDistractionMode() {
            state.distractionActive = true;
            
            // éšæœºé€‰ä¸€ä¸ªä¾§è¾¹æ å¹¿å‘Š
            const targetAd = distractions[Math.floor(Math.random() * distractions.length)];
            
            // ç»™å®ƒåŠ ä¸Šâ€œæ¿€æ´»â€æ ·å¼ï¼ˆå˜éœ“è™¹è‰²ã€éœ‡åŠ¨ï¼‰
            targetAd.classList.add('active');

            // ç›‘å¬ï¼šå¿…é¡»æŠŠé¼ æ ‡ç§»ä¸Šå»æ‰èƒ½è§£é™¤
            // è¿™æ˜¯ä¸€ä¸ªä¸€æ¬¡æ€§çš„ç›‘å¬å™¨
            targetAd.onmouseenter = () => {
                // å¢åŠ å¤±è´¥è®¡æ•°
                state.failCount++;
                
                // æš‚æ—¶è§£é™¤å¹²æ‰°
                targetAd.classList.remove('active');
                state.currentBlur = 0; // é‡ç½®æ¨¡ç³Š
                state.distractionActive = false;
                targetAd.onmouseenter = null; // æ¸…é™¤ç›‘å¬

                // æ£€æŸ¥æ˜¯å¦ç»“æŸæ¸¸æˆ (æ¯”å¦‚ 3 æ¬¡å)
                checkGameOver();
            };
        }

        function checkGameOver() {
            if (state.failCount >= 3) {
                setTimeout(() => {
                    distCountSpan.innerText = state.failCount;
                    diagOverlay.style.display = 'block'; // æ˜¾ç¤ºè¯Šæ–­é¡µ
                    state.isStarted = false; // åœæ­¢å¾ªç¯
                }, 500);
            }
        }

    </script>
</body>
</html>
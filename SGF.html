<!-- SGF SesoryGatingFailure  æ„Ÿå®˜é—¨æ§å¤±æ•ˆ-->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ„Ÿå®˜é—¨æ§å¤±æ•ˆæ¨¡æ‹ŸV2ï¼šæ¸¸èµ°å¹²æ‰°ä¸éšè—ä¿¡æ¯</title>
    <style>
        :root {
            --bg-color: #f0f2f5;
            --text-color: #333;
            --accent: #0056b3;
            --distraction-color-1: #ff0055; /* çº¢è‰² */
            --distraction-color-2: #00aaff; /* è“è‰² */
            --distraction-color-3: #ffaa00; /* æ©™è‰² */
            --distraction-color-4: #aa00ff; /* ç´«è‰² */
            --distraction-color-5: #00ffaa; /* é’è‰² */
            --distraction-color-6: #ff5500; /* æ©™çº¢è‰² */
        }

        body {
            margin: 0;
            padding: 0;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            overflow: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            perspective: 1000px; /* ç”¨äº3Dæ•ˆæœ */
        }

        /* ä¸»å®¹å™¨ */
        .container {
            position: relative;
            width: 90%;
            max-width: 1000px;
            height: 90vh;
            background: white;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-radius: 12px;
            overflow: hidden; /* é˜²æ­¢å†…å®¹æº¢å‡º */
            display: flex;
            gap: 20px;
            opacity: 0.3; /* åˆå§‹æ—¶å†…å®¹åŒºåŸŸå˜æš— */
            filter: blur(2px); /* åˆå§‹æ—¶æ¨¡ç³Šæ•ˆæœ */
            transition: opacity 0.5s ease, filter 0.5s ease;
        }

            .container.active {
                opacity: 1;
                filter: blur(0);
            }

        /* æ ¸å¿ƒå†…å®¹åŒº - å˜çª„ï¼Œä¸ºå¹²æ‰°å…ƒç´ ç•™å‡ºç©ºé—´ */
        .content-layer {
            position: relative;
            z-index: 10;
            width: 65%;
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: filter 0.3s ease-out, opacity 0.3s ease-out;
            /* åˆå§‹çŠ¶æ€è½»å¾®æ¨¡ç³Šï¼Œæ¨¡æ‹ŸADHDçš„åŸºçº¿æ³¨æ„åŠ›æ¶£æ•£ */
            filter: blur(0.5px);
        }

        /* å¹²æ‰°å…ƒç´ ä¾§è¾¹æ  */
        .distraction-sidebar {
            width: 35%;
            height: 100%;
            position: relative;
            background: #f8f9fa;
            border-left: 1px solid #e0e0e0;
            padding: 15px;
            overflow-y: auto;
            border-radius: 8px;
        }

        h1 {
            color: var(--accent);
            border-bottom: 2px solid #eee;
            padding-bottom: 15px;
        }

        .flight-info {
            background: #e6f0ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
            font-weight: bold;
            color: var(--accent);
        }

        .policy-text {
            line-height: 2;
            font-size: 18px;
            color: #444;
            text-align: justify;
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 10px;
            transition: opacity 0.5s ease, color 0.5s ease, filter 0.5s ease;
        }

        /* éšè—åœ¨æ­£æ–‡ä¸­çš„éªŒè¯ç æ ·å¼ */
        .hidden-code {
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            background: #f4f4f4;
            padding: 2px 5px;
            border-radius: 4px;
            border: 1px dashed #ccc;
            transition: all 0.3s ease;
        }

        .input-area {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid #eee;
            display: flex;
            gap: 10px;
            transition: opacity 0.3s ease;
        }

        input[type="text"] {
            flex-grow: 1;
            padding: 12px;
            font-size: 16px;
            border: 2px solid #ddd;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

            input[type="text"]:disabled {
                background-color: #f5f5f5;
                color: #999;
                border-color: #ccc;
                cursor: not-allowed;
            }

        .btn {
            background: var(--accent);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.2s;
        }

            .btn:disabled {
                background: #cccccc;
                cursor: not-allowed;
            }

            .btn:hover:not(:disabled) {
                background: #004494;
            }

        /* ======= é™æ€å¹²æ‰°å…ƒç´  (ç½‘é¡µå†…å›ºå®šå¹²æ‰°) ======= */
        .static-distraction {
            background: white;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            transition: all 0.4s ease;
            cursor: pointer;
            opacity: 0.9;
        }

            .static-distraction.highlighted {
                box-shadow: 0 0 25px currentColor;
                transform: scale(1.05);
                z-index: 100;
                position: relative;
                animation: glow-pulse 1.5s infinite alternate;
            }

        @keyframes glow-pulse {
            0% {
                box-shadow: 0 0 15px currentColor;
            }

            100% {
                box-shadow: 0 0 35px currentColor;
            }
        }

        .distraction-title {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .distraction-content {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }

        /* ======= å¤šæ ·åŒ–å°å¹¿å‘Šæ ·å¼ ======= */
        /* åŸºç¡€å¹¿å‘Šæ ·å¼ */
        .popup-ad {
            position: absolute;
            z-index: 1000;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s ease;
            opacity: 0;
            transform: scale(0.9);
        }

            .popup-ad.active {
                opacity: 1;
                transform: scale(1);
            }

            .popup-ad.highlighted {
                border-color: currentColor;
                animation: popup-glow 1s infinite alternate;
                z-index: 1001;
            }

        @keyframes popup-glow {
            0% {
                box-shadow: 0 0 15px currentColor;
            }

            100% {
                box-shadow: 0 0 30px currentColor;
            }
        }

        .popup-ad-close {
            position: absolute;
            top: 5px;
            right: 10px;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            z-index: 10;
            background: rgba(0,0,0,0.3);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

            .popup-ad-close:hover {
                background: rgba(255,0,0,0.7);
                color: white;
            }

        /* ç±»å‹1: æ ‡å‡†çŸ©å½¢å¹¿å‘Š */
        .ad-type-standard {
            width: 220px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            padding: 15px;
        }

            .ad-type-standard .distraction-title {
                color: #333;
            }

            .ad-type-standard .distraction-content {
                color: #666;
            }

        /* ç±»å‹2: æ¨ªå¹…å¹¿å‘Š */
        .ad-type-banner {
            width: 300px;
            height: 60px;
            background: linear-gradient(45deg, #ff9966, #ff5e62);
            border-radius: 4px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            padding: 10px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: white;
            font-weight: bold;
        }

            .ad-type-banner .distraction-title {
                color: white;
                font-size: 16px;
                margin-bottom: 0;
            }

            .ad-type-banner .distraction-content {
                color: rgba(255,255,255,0.9);
                font-size: 12px;
            }

        /* ç±»å‹3: åœ†å½¢å›¾æ ‡å¹¿å‘Š */
        .ad-type-circle {
            width: 100px;
            height: 100px;
            background: linear-gradient(45deg, #2193b0, #6dd5ed);
            border-radius: 50%;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            padding: 10px;
        }

            .ad-type-circle .distraction-title {
                color: white;
                font-size: 18px;
                margin-bottom: 5px;
            }

            .ad-type-circle .distraction-content {
                color: rgba(255,255,255,0.9);
                font-size: 12px;
            }

        /* ç±»å‹4: æ ‡å‡†å¹¿å‘Šï¼ˆåŸå€’è®¡æ—¶å¹¿å‘Šï¼‰ */
        .ad-type-countdown {
            width: 180px;
            background: linear-gradient(45deg, #834d9b, #d04ed6);
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            padding: 15px;
            color: white;
            text-align: center;
        }

            .ad-type-countdown .distraction-title {
                color: white;
            }

            .ad-type-countdown .distraction-content {
                color: rgba(255,255,255,0.9);
            }

        /* ç±»å‹5: é—ªçƒè­¦å‘Šå¹¿å‘Š */
        .ad-type-warning {
            width: 250px;
            background: #ff4444;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            padding: 15px;
            color: white;
            text-align: center;
            animation: warning-blink 1s infinite;
        }

        @keyframes warning-blink {
            0%, 100% {
                background-color: #ff4444;
            }

            50% {
                background-color: #ff8888;
            }
        }

        .ad-type-warning .distraction-title {
            color: white;
        }

        .ad-type-warning .distraction-content {
            color: rgba(255,255,255,0.9);
        }

        /* ç±»å‹6: é€šçŸ¥å¡ç‰‡å¹¿å‘Š */
        .ad-type-notification {
            width: 260px;
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            padding: 20px;
            color: white;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

            .ad-type-notification .notification-icon {
                font-size: 24px;
                margin-bottom: 10px;
                text-align: center;
            }

            .ad-type-notification .distraction-title {
                color: white;
                font-size: 18px;
                margin-bottom: 5px;
            }

            .ad-type-notification .distraction-content {
                color: rgba(255,255,255,0.9);
                font-size: 14px;
                line-height: 1.4;
            }

        /* ç±»å‹7: ä¼˜æƒ åˆ¸å¹¿å‘Š */
        .ad-type-coupon {
            width: 240px;
            background: white;
            border: 2px dashed #ff5500;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            padding: 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

            .ad-type-coupon::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 6px;
                background: linear-gradient(90deg, #ff5500, #ffaa00);
            }

            .ad-type-coupon .coupon-code {
                background: #fff8e6;
                border: 1px dashed #ffaa00;
                padding: 8px 12px;
                margin: 10px 0;
                font-family: 'Courier New', monospace;
                font-weight: bold;
                color: #ff5500;
                border-radius: 4px;
            }

            .ad-type-coupon .distraction-title {
                color: #ff5500;
                font-size: 18px;
                margin-bottom: 10px;
            }

            .ad-type-coupon .distraction-content {
                color: #666;
                font-size: 14px;
            }

        /* æš—æ·¡æ•ˆæœ */
        .dimmed {
            opacity: 0.3 !important;
            color: #888 !important;
            filter: blur(1.5px) !important;
        }

        /* è¾“å…¥æ¡†ç¦ç”¨è¦†ç›–å±‚ */
        .input-overlay {
            position: absolute;
            bottom: 30px;
            left: 30px;
            right: calc(35% + 50px);
            height: 60px;
            background: rgba(255, 255, 255, 0.95);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            border: 2px dashed #ff4444;
            font-weight: bold;
            color: #ff4444;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

            .input-overlay.active {
                opacity: 1;
            }

        /* å¼¹çª—æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        }

        .modal {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 700px;
            max-height: 85vh;
            overflow-y: auto;
            padding: 30px;
            position: relative;
            animation: modal-appear 0.4s ease-out;
        }

        @keyframes modal-appear {
            0% {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }

            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-title {
            color: #0056b3;
            font-size: 28px;
            margin: 0 0 10px 0;
        }

        .modal-subtitle {
            color: #666;
            font-size: 16px;
            margin: 0;
        }

        .modal-content {
            line-height: 1.7;
            font-size: 17px;
            color: #444;
        }

        .modal-warning {
            background: #fff8e6;
            border-left: 4px solid #ffaa00;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 4px 4px 0;
        }

        .modal-highlight {
            color: #ff4d4d;
            font-weight: bold;
        }

        .modal-close-btn {
            background: linear-gradient(45deg, #0056b3, #004494);
            color: white;
            border: none;
            padding: 14px 32px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            display: block;
            margin: 30px auto 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 86, 179, 0.3);
        }

            .modal-close-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(0, 86, 179, 0.4);
                background: linear-gradient(45deg, #004494, #003377);
            }

        /* è¦†ç›–å±‚ (ç»“æœç•Œé¢) */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.92);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            text-align: center;
            padding: 20px;
        }

        .hidden {
            display: none !important;
        }

        .stats-highlight {
            font-size: 4em;
            color: #ff0055;
            font-weight: bold;
            display: block;
            margin: 20px 0;
        }

        /* ç»“æœé¡µé¢çš„æŒ‰é’®å®¹å™¨ */
        .result-buttons {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

            .result-buttons .btn {
                min-width: 160px;
            }

        /* ç§‘æ™®é¡µé¢æŒ‰é’®ç‰¹æ®Šæ ·å¼ */
        .btn-science {
            background: linear-gradient(45deg, #00aaff, #0088cc);
        }

            .btn-science:hover {
                background: linear-gradient(45deg, #0088cc, #006699);
            }

        /* å†è¯•ä¸€æ¬¡æŒ‰é’®ç‰¹æ®Šæ ·å¼ */
        .btn-retry {
            background: linear-gradient(45deg, #ff5500, #cc4400);
        }

            .btn-retry:hover {
                background: linear-gradient(45deg, #cc4400, #aa3300);
            }
    </style>
</head>
<body>

    <!-- å¼¹çª—æç¤ºç•Œé¢ -->
    <div id="start-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h1 class="modal-title">æ„Ÿå®˜è¿‡è½½æ¨¡æ‹Ÿ V2.2</h1>
                <p class="modal-subtitle">ADHDæ³¨æ„åŠ›åˆ†æ•£ä½“éªŒæ¨¡æ‹Ÿ</p>
            </div>

            <div class="modal-content">
                <p><strong>ä»»åŠ¡å˜æ›´ï¼š</strong></p>
                <p>éªŒè¯ç ç°åœ¨<span class="modal-highlight">éšè—åœ¨æ­£æ–‡ä¸­</span>ã€‚</p>
                <p>ç½‘é¡µå³ä¾§æœ‰<span class="modal-highlight">å›ºå®šçš„å¹²æ‰°ä¿¡æ¯</span>ï¼Œå®ƒä»¬ä¼š<span class="modal-highlight">éšæœºé«˜äº®</span>å¸å¼•æ³¨æ„åŠ›ã€‚</p>
                <p>å½“å¹²æ‰°ä¿¡æ¯é«˜äº®æ—¶ï¼Œä¸»æ–‡æœ¬ä¼š<span class="modal-highlight">å˜å¾—æš—æ·¡æ¨¡ç³Š</span>ã€‚</p>
                <p>é¡µé¢ä¸­ä¼šéšæœºå¼¹å‡º<span class="modal-highlight">å¤šç§å½¢å¼çš„å°å¹¿å‘Š</span>ã€‚</p>

                <div class="modal-warning">
                    <strong>âš ï¸ é‡è¦æç¤ºï¼š</strong>
                    <p>å½“å¹¿å‘Šé«˜äº®æ—¶ï¼Œæ‚¨å°†æ— æ³•è¾“å…¥éªŒè¯ç ï¼</p>
                    <p>æ‚¨å¿…é¡»<span class="modal-highlight">ç‚¹å‡»</span>é«˜äº®çš„å¹²æ‰°é¡¹æˆ–å¹¿å‘Šï¼Œæ‰èƒ½æ¢å¤é˜…è¯»æ¸…æ™°åº¦å’Œè¾“å…¥èƒ½åŠ›ã€‚</p>
                </div>

                <p><small>è­¦å‘Šï¼šæœ¬æ¨¡æ‹ŸåŒ…å«é—ªçƒå…ƒç´ å’Œå°–é”å£°éŸ³ï¼Œè¯·ç¡®ä¿ä½©æˆ´è€³æœºä»¥è·å¾—å®Œæ•´ä½“éªŒã€‚</small></p>

                <button class="modal-close-btn" onclick="startSimulation()">
                    æˆ‘å‡†å¤‡å¥½äº† (å¼€å§‹ä½“éªŒ)
                </button>
            </div>
        </div>
    </div>

    <div id="result-screen" class="overlay hidden">
        <h2>æ¨¡æ‹Ÿç»“æŸ</h2>
        <div>ä¸ºäº†åœ¨å¹²æ‰°ä¸­æ‰¾åˆ°é‚£ä¸ªç®€çŸ­çš„ä»£ç ï¼Œæ‚¨è¢«è¿«å¤„ç†äº†ï¼š</div>
        <span id="distraction-count" class="stats-highlight">0</span>
        <div>ä¸ªé«˜äº®å¹²æ‰°é¡¹å’Œå¼¹å‡ºå¹¿å‘Šã€‚</div>
        <p style="max-width: 600px; text-align: left; margin-top: 40px; line-height: 1.6; background: rgba(255,255,255,0.1); padding: 20px; border-radius: 10px;">
            <strong>ä½“éªŒæ€»ç»“ï¼š</strong><br>
            è¿™æ¬¡æ¨¡æ‹Ÿå¢åŠ äº†"é€‰æ‹©æ€§æ³¨æ„"å’Œ"æ‰§è¡Œæ§åˆ¶"çš„è®¤çŸ¥è´Ÿè·ã€‚å½“å¹¿å‘Šé«˜äº®æ—¶ï¼Œæ‚¨ä¸ä»…å¤±å»äº†è§†è§‰æ¸…æ™°åº¦ï¼Œè¿˜è¢«å‰¥å¤ºäº†è¾“å…¥èƒ½åŠ›ï¼Œè¿™æ¨¡æ‹Ÿäº†ADHDæ‚£è€…åœ¨æ„Ÿå®˜è¿‡è½½æ—¶å‡ºç°çš„"æ‰§è¡ŒåŠŸèƒ½ç˜«ç—ª"ç°è±¡ã€‚<br>
            æ‚¨åˆšæ‰ä¸å¾—ä¸åœä¸‹é˜…è¯»å»ç‚¹å‡»å¹²æ‰°é¡¹çš„è¡Œä¸ºï¼Œå®Œç¾å¤ç°äº†ADHDå¤§è„‘ä¸ºäº†"é‡å¯"æ³¨æ„åŠ›è€Œè¢«è¿«è¿›è¡Œçš„ä¸­æ–­è¡Œä¸ºã€‚ç½‘é¡µä¸­å›ºæœ‰çš„å¹²æ‰°é¡¹æ¨¡æ‹Ÿäº†çœŸå®ç¯å¢ƒä¸­çš„ä¿¡æ¯è¿‡è½½ã€‚
        </p>
        <div class="result-buttons">
            <button class="btn btn-retry" onclick="location.reload()">å†è¯•ä¸€æ¬¡</button>
            <button class="btn btn-science" onclick="goToSciencePage()">è¿›å…¥ç§‘æ™®é¡µé¢</button>
        </div>
    </div>

    <div class="container" id="main-container">
        <!-- è¾“å…¥æ¡†ç¦ç”¨è¦†ç›–å±‚ -->
        <div class="input-overlay" id="input-overlay">
            <span>âš ï¸ å¹¿å‘Šé«˜äº®ä¸­ï¼Œæ— æ³•è¾“å…¥ï¼è¯·å…ˆç‚¹å‡»å¹¿å‘Š</span>
        </div>

        <!-- ä¸»è¦å†…å®¹åŒº -->
        <div class="content-layer" id="main-content">
            <h1>èˆªç­æ”¹ç­¾æ”¿ç­–ç¡®è®¤å‡½</h1>
            <div class="flight-info">
                æ–‡æ¡£ç¼–å·ï¼šCA-2024-PS-78945 | ç”Ÿæˆæ—¥æœŸï¼š2024å¹´1æœˆ13æ—¥
            </div>
            <div class="policy-text" id="policy-text">
                <p>å°Šæ•¬çš„æ—…å®¢ï¼š</p>
                <p>æ‚¨å¥½ï¼æ„Ÿè°¢æ‚¨é€‰æ‹©æˆ‘ä»¬çš„èˆªç©ºæœåŠ¡ã€‚ä¸ºç¡®ä¿æ‚¨çš„æƒç›Šå¹¶è§„èŒƒåç»­æ“ä½œæµç¨‹ï¼Œç‰¹æ­¤ç¡®è®¤æœ¬æ¬¡èˆªç­æ”¹ç­¾ç›¸å…³æ”¿ç­–æ¡æ¬¾ã€‚æœ¬ç¡®è®¤å‡½æ‰€è½½å†…å®¹å‡ä¸ºæœ€ç»ˆåè®®ä¾æ®ï¼Œè¯·å¦¥å–„ä¿ç®¡ã€‚</p>

                <h3>ä¸€ã€æ”¹ç­¾åŸºæœ¬è§„åˆ™</h3>
                <p>
                    1. <strong>æ—¶é—´é™åˆ¶ï¼š</strong> æ”¹ç­¾ç”³è¯·é¡»åœ¨åŸèˆªç­èµ·é£å‰4å°æ—¶æäº¤ï¼Œç‰¹æ®Šèˆªçº¿ï¼ˆå¦‚å›½é™…é•¿é€”ã€ä»£ç å…±äº«èˆªç­ï¼‰éœ€æå‰24å°æ—¶ã€‚é€¾æœŸä»…å¯åœ¨æœºåœºæŸœå°åŠç†ï¼Œä¸”é€‚ç”¨æ›´é«˜è´¹ç‡ã€‚<br>
                    2. <strong>è´¹ç”¨æ ‡å‡†ï¼š</strong> åŒèˆ±ä½æ”¹ç­¾æ”¶å–ç¥¨é¢ä»·æ ¼10%ä½œä¸ºæ‰‹ç»­è´¹ï¼›èˆ±ä½å‡çº§éœ€è¡¥è¶³ä»·å·®å¹¶åŠ æ”¶5%æœåŠ¡è´¹ï¼›é™çº§æ”¹ç­¾é€€è¿˜å·®ä»·ä½†æ”¶å–15%è¿çº¦é‡‘ã€‚ç‰¹ä»·æœºç¥¨ã€é‡Œç¨‹å…‘æ¢ç¥¨åŠå›¢ä½“ç¥¨å¯èƒ½ä¸é€‚ç”¨å…è´¹æ”¹ç­¾æ”¿ç­–ã€‚<br>
                    3. <strong>èˆªç­é€‰æ‹©ï¼š</strong> ä»…å¯æ”¹ç­¾åˆ°ç›¸åŒèˆªçº¿çš„åç»­èˆªç­ï¼Œä¸”ç›®æ ‡èˆªç­éœ€æœ‰å¯å”®åº§ä½ã€‚è‹¥åŸèˆ±ä½å·²æ»¡ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ¨èç›¸é‚»èˆ±ä½é€‰é¡¹ã€‚
                </p>

                <h3>äºŒã€ç‰¹æ®Šæƒ…å½¢å¤„ç†</h3>
                <p>å› èˆªç©ºå…¬å¸åŸå› ï¼ˆå¦‚èˆªç­å–æ¶ˆã€æ—¶åˆ»è°ƒæ•´è¶…è¿‡2å°æ—¶ï¼‰å¯¼è‡´çš„æ”¹ç­¾ï¼Œæ—…å®¢å¯å…æ‰‹ç»­è´¹åŠç†ä¸€æ¬¡ï¼Œæˆ–é€‰æ‹©å…¨é¢é€€ç¥¨ã€‚å¤©æ°”ã€ç©ºç®¡ç­‰ä¸å¯æŠ—åŠ›å› ç´ é€ æˆçš„æ”¹ç­¾ï¼Œä¾æ®æ°‘èˆªå±€ç›¸å…³è§„å®šæ‰§è¡Œï¼Œè´¹ç”¨å¯åå•†å‡å…ä½†éå¼ºåˆ¶æ€§ã€‚æ—…å®¢å› å¥åº·åŸå› ç”³è¯·æ”¹ç­¾ï¼Œéœ€æä¾›äºŒçº§ç”²ç­‰ä»¥ä¸ŠåŒ»é™¢è¯æ˜ï¼Œå¯é…Œæƒ…å‡å…50%æ‰‹ç»­è´¹ã€‚</p>

                <h3>ä¸‰ã€ç¡®è®¤ä¸æ‰¿è¯º</h3>
                <p>æœ¬äººå·²è¯¦ç»†é˜…è¯»å¹¶å®Œå…¨ç†è§£ä¸Šè¿°æ”¹ç­¾æ”¿ç­–ï¼Œè‡ªæ„¿ç”³è¯·å¯¹è®¢å•å·CA20240113BJSHçš„èˆªç­è¿›è¡Œæ”¹ç­¾æ“ä½œã€‚ç¡®è®¤æœ¬å‡½éªŒè¯ç  <span class="hidden-code" id="target-code">07FPL6</span> çœŸå®æœ‰æ•ˆï¼ŒåŒæ„éµå®ˆèˆªç©ºå…¬å¸ä¸€åˆ‡åˆç†è§„å®šï¼Œå¹¶æ‰¿æ‹…ç›¸åº”è´¹ç”¨ã€‚åç»­æ‰€æœ‰æ²Ÿé€šå‡ä»¥æœ¬ç¡®è®¤å‡½è®°è½½å†…å®¹ä¸ºå‡†ï¼Œå£å¤´æ‰¿è¯ºæ— æ•ˆã€‚</p>
                <p style="margin-top: 20px; font-size: 0.9em; color: #666;">å®¢æœå·¥å·ï¼šCS240113-008 | å¤æ ¸æ—¶é—´ï¼š2024å¹´1æœˆ13æ—¥ 14:30:22</p>
            </div>

            <div class="input-area">
                <input type="text" id="captcha-input" placeholder="è¯·è¾“å…¥éªŒè¯ç ...">
                <button class="btn" id="submit-btn" onclick="checkCaptcha()">æäº¤éªŒè¯</button>
            </div>
        </div>

        <!-- å¹²æ‰°å…ƒç´ ä¾§è¾¹æ  -->
        <div class="distraction-sidebar" id="distraction-sidebar">
            <h3 style="margin-top: 0; color: #666;">ç›¸å…³æ¨èä¸é€šçŸ¥</h3>

            <div class="static-distraction" id="distraction-1" data-color="#ff0055">
                <div class="distraction-title" style="color: #ff0055;">â— ç´§æ€¥ç³»ç»Ÿé€šçŸ¥</div>
                <div class="distraction-content">æ‚¨çš„è´¦æˆ·å®‰å…¨ç­‰çº§è¾ƒä½ï¼Œå»ºè®®ç«‹å³å‡çº§é˜²æŠ¤ã€‚æ£€æµ‹åˆ°3æ¬¡å¼‚å¸¸ç™»å½•å°è¯•ï¼Œè¯·éªŒè¯èº«ä»½ã€‚</div>
            </div>

            <div class="static-distraction" id="distraction-2" data-color="#00aaff">
                <div class="distraction-title" style="color: #00aaff;">ğŸ”¥ çƒ­é—¨æ—…æ¸¸æ¨è</div>
                <div class="distraction-content">å·´å˜å²›7æ—¥è±ªåæ¸¸ä»…Â¥3999ï¼é™æ—¶ç‰¹æƒ ï¼ŒåŒ…å«æœºç¥¨é…’åº—ã€‚å‰©ä½™åé¢ï¼š12ä¸ªã€‚</div>
            </div>

            <div class="static-distraction" id="distraction-3" data-color="#ffaa00">
                <div class="distraction-title" style="color: #ffaa00;">ğŸ“§ æœªè¯»æ¶ˆæ¯ (3)</div>
                <div class="distraction-content">æ‚¨æœ‰3æ¡æœªè¯»æ¶ˆæ¯ï¼Œå…¶ä¸­1æ¡æ ‡è®°ä¸ºé‡è¦ã€‚æ¥è‡ªï¼šå®¢æœä¸­å¿ƒã€ä¿ƒé”€æ´»åŠ¨ã€ç³»ç»Ÿé€šçŸ¥ã€‚</div>
            </div>

            <div class="static-distraction" id="distraction-4" data-color="#aa00ff">
                <div class="distraction-title" style="color: #aa00ff;">ğŸ° å°æ¸¸æˆæ¨è</div>
                <div class="distraction-content">ä¼‘æ¯ä¸€ä¸‹ï¼Ÿè¯•è¯•æˆ‘ä»¬çš„æ—…è¡Œå°æ¸¸æˆï¼Œæœ‰æœºä¼šèµ¢å–1000é‡Œç¨‹ç§¯åˆ†ï¼ç‚¹å‡»å¼€å§‹ã€‚</div>
            </div>

            <div class="static-distraction" id="distraction-5" data-color="#00ffaa">
                <div class="distraction-title" style="color: #00ffaa;">ğŸ“Š æ•°æ®åˆ†ææŠ¥å‘Š</div>
                <div class="distraction-content">æ ¹æ®æ‚¨çš„æµè§ˆè®°å½•ï¼Œæˆ‘ä»¬ä¸ºæ‚¨æ¨èäº†5ä¸ªç›¸ä¼¼ç›®çš„åœ°ã€‚78%çš„ç”¨æˆ·å¯¹è¿™äº›æ¨èæ„Ÿå…´è¶£ã€‚</div>
            </div>

            <div class="static-distraction" id="distraction-6" data-color="#ff5500">
                <div class="distraction-title" style="color: #ff5500;">âš ï¸ æµè§ˆå™¨è­¦å‘Š</div>
                <div class="distraction-content">æ£€æµ‹åˆ°æ‚¨çš„æµè§ˆå™¨ç‰ˆæœ¬è¾ƒä½ï¼Œå¯èƒ½å­˜åœ¨å®‰å…¨é£é™©ã€‚å»ºè®®ç«‹å³æ›´æ–°ä»¥è·å¾—æ›´å¥½ä½“éªŒã€‚</div>
            </div>
        </div>
    </div>

    <script>
        // --- é…ç½®çŠ¶æ€ ---
        let state = {
            started: false,
            chaosLevel: 0,
            distractionsClicked: 0,
            textDimmed: false,
            currentHighlighted: null,
            popupAds: [],
            spawnRateMs: 2500,
            highlightInterval: null,
            inputBlocked: false,
            highlightedAds: new Set(),
            highlightedSidebarItems: new Set(),
            adTimers: new Map(),
            maxAds: 6,
            baseSpawnChance: 50,
            baseHighlightChance: 70
        };

        const correctCaptcha = "07FPL6";
        const distractionElements = [];
        const policyText = document.getElementById('policy-text');
        const captchaInput = document.getElementById('captcha-input');
        const submitBtn = document.getElementById('submit-btn');
        const inputOverlay = document.getElementById('input-overlay');
        const targetCode = document.getElementById('target-code');
        const mainContainer = document.getElementById('main-container');
        const startModal = document.getElementById('start-modal');

        // å¹¿å‘Šæ•°æ® - ç§»é™¤äº†æ°”çƒå¹¿å‘Šï¼Œæ–°å¢äº†é€šçŸ¥å¡ç‰‡å’Œä¼˜æƒ åˆ¸å¹¿å‘Š
        const popupAdsData = [
            {
                type: "standard",
                title: "é™æ—¶ç‰¹æƒ ï¼",
                content: "æœºç¥¨ç›´é™50%ï¼ç‚¹å‡»é¢†å–ä¼˜æƒ åˆ¸",
                color: "#ff0055",
                textColor: "#333333"
            },
            {
                type: "banner",
                title: "å…è´¹å‡èˆ±æœºä¼š",
                content: "ç‚¹å‡»å‚ä¸æŠ½å¥–ï¼Œèµ¢å–å…è´¹å‡èˆ±ï¼",
                color: "#00aaff",
                textColor: "#ffffff"
            },
            {
                type: "circle",
                title: "WiFi",
                content: "å…è´¹è¿æ¥",
                color: "#ffaa00",
                textColor: "#ffffff"
            },
            {
                type: "countdown",
                title: "ç§’æ€ç‰¹æƒ ",
                content: "ç‰¹ä»·æœºç¥¨å³å°†å”®ç½„ï¼",
                color: "#aa00ff",
                textColor: "#ffffff"
            },
            {
                type: "warning",
                title: "å®‰å…¨è­¦å‘Šï¼",
                content: "æ‚¨çš„è¿æ¥ä¸å®‰å…¨ï¼ç«‹å³ä¿®å¤",
                color: "#ff4444",
                textColor: "#ffffff"
            },
            {
                type: "notification",
                title: "ç³»ç»Ÿé€šçŸ¥",
                content: "æ‚¨æœ‰æ–°çš„èˆªç­æ¨èï¼Œç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…",
                color: "#4CAF50",
                textColor: "#ffffff"
            },
            {
                type: "coupon",
                title: "ä¸“å±ä¼˜æƒ åˆ¸",
                content: "ç«‹å³ä½¿ç”¨ï¼Œç«‹å‡200å…ƒ",
                couponCode: "FLY200",
                color: "#ff5500",
                textColor: "#333333"
            },
            {
                type: "standard",
                title: "æ–°ç”¨æˆ·ä¸“äº«",
                content: "æ³¨å†Œå³é€200å…ƒä¼˜æƒ åˆ¸",
                color: "#ff5500",
                textColor: "#333333"
            },
            {
                type: "banner",
                title: "ä¼šå‘˜ä¸“å±",
                content: "ä¼šå‘˜æ—¥å…¨åœº8æŠ˜ï¼Œä»…é™ä»Šå¤©",
                color: "#aa00ff",
                textColor: "#ffffff"
            },
            {
                type: "circle",
                title: "å®¢æœ",
                content: "åœ¨çº¿å’¨è¯¢",
                color: "#00aaff",
                textColor: "#ffffff"
            },
            {
                type: "warning",
                title: "ç—…æ¯’è­¦å‘Š",
                content: "æ£€æµ‹åˆ°å¯ç–‘æ´»åŠ¨ï¼Œç«‹å³æ‰«æ",
                color: "#ff0000",
                textColor: "#ffffff"
            },
            {
                type: "notification",
                title: "æé†’",
                content: "æ‚¨çš„èˆªç­å³å°†èµ·é£ï¼Œè¯·å°½å¿«åŠç†å€¼æœº",
                color: "#2196F3",
                textColor: "#ffffff"
            }
        ];

        // Audio Context
        let audioCtx;
        let whiteNoiseGain;

        // --- æ ¸å¿ƒæµç¨‹ ---

        function startSimulation() {
            // éšè—å¼¹çª—
            startModal.classList.add('hidden');

            // æ¿€æ´»ä¸»å®¹å™¨ï¼Œä½¿å…¶å˜æ¸…æ™°
            mainContainer.classList.add('active');

            state.started = true;
            initAudio();

            // æ”¶é›†æ‰€æœ‰é™æ€å¹²æ‰°å…ƒç´ 
            for (let i = 1; i <= 6; i++) {
                const el = document.getElementById(`distraction-${i}`);
                distractionElements.push(el);

                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                el.addEventListener('click', function () {
                    handleDistractionClick(this);
                });
            }

            // å¯åŠ¨å¹²æ‰°é«˜äº®ç³»ç»Ÿ
            startHighlightSystem();

            // å¯åŠ¨å¼¹å‡ºå¹¿å‘Šç³»ç»Ÿ
            startPopupAdSystem();

            // åˆå§‹åŒ–è¾“å…¥æ¡†çŠ¶æ€
            updateInputState();
        }

        function stopSimulation() {
            state.started = false;
            if (audioCtx) audioCtx.close();

            // æ¸…é™¤æ‰€æœ‰å®šæ—¶å™¨
            clearInterval(state.highlightInterval);

            // æ¸…é™¤æ‰€æœ‰å¹¿å‘Šå®šæ—¶å™¨
            state.adTimers.forEach(timerId => {
                clearTimeout(timerId);
            });
            state.adTimers.clear();

            // æ¸…é™¤æ‰€æœ‰å¼¹å‡ºå¹¿å‘Š
            document.querySelectorAll('.popup-ad').forEach(el => {
                el.remove();
            });

            document.getElementById('result-screen').classList.remove('hidden');
            document.getElementById('distraction-count').innerText = state.distractionsClicked;
        }

        function checkCaptcha() {
            // å¦‚æœè¾“å…¥è¢«é˜»æ­¢ï¼Œç›´æ¥è¿”å›
            if (state.inputBlocked) {
                playBlockedSound();
                return;
            }

            const input = document.getElementById('captcha-input').value;
            if (input.toUpperCase() === correctCaptcha) {
                stopSimulation();
            } else {
                alert("éªŒè¯ç é”™è¯¯ã€‚è¯·åœ¨æ­£æ–‡ä¸­ä»”ç»†å¯»æ‰¾ã€‚");
                state.chaosLevel += 10;
                updateVisuals();

                // éªŒè¯ç æŠ–åŠ¨æ•ˆæœ
                targetCode.style.color = "#ff4444";
                targetCode.style.backgroundColor = "#ffe6e6";
                targetCode.style.transform = "translateX(5px)";
                setTimeout(() => {
                    targetCode.style.transform = "translateX(-5px)";
                    setTimeout(() => {
                        targetCode.style.transform = "translateX(0)";
                        setTimeout(() => {
                            targetCode.style.color = "";
                            targetCode.style.backgroundColor = "";
                        }, 300);
                    }, 100);
                }, 100);
            }
        }

        function goToSciencePage() {
            window.location.href = "web1.1.html";
        }

        // --- è¾“å…¥çŠ¶æ€æ§åˆ¶ ---
        function updateInputState() {
            // æ£€æŸ¥æ˜¯å¦æœ‰ä»»ä½•é«˜äº®å…ƒç´ ï¼ˆå¹¿å‘Šæˆ–ä¾§è¾¹æ é¡¹ç›®ï¼‰
            const hasHighlightedElements = state.highlightedAds.size > 0 || state.highlightedSidebarItems.size > 0;

            if (hasHighlightedElements) {
                // è¾“å…¥è¢«é˜»æ­¢
                state.inputBlocked = true;
                captchaInput.disabled = true;
                submitBtn.disabled = true;
                inputOverlay.classList.add('active');

                captchaInput.style.borderColor = "#ff4444";
                captchaInput.style.animation = "shake 0.5s";
                setTimeout(() => {
                    captchaInput.style.animation = "";
                }, 500);
            } else {
                // è¾“å…¥æ¢å¤
                state.inputBlocked = false;
                captchaInput.disabled = false;
                submitBtn.disabled = false;
                inputOverlay.classList.remove('active');
                captchaInput.style.borderColor = "#ddd";
            }
        }

        // --- é«˜äº®ç³»ç»Ÿ ---
        function startHighlightSystem() {
            function highlightRandomDistraction() {
                if (!state.started) return;

                // å¦‚æœæœ‰å½“å‰é«˜äº®çš„å…ƒç´ ï¼Œå…ˆå–æ¶ˆé«˜äº®
                if (state.currentHighlighted) {
                    state.currentHighlighted.classList.remove('highlighted');
                    state.highlightedSidebarItems.delete(state.currentHighlighted.id);
                    if (state.textDimmed) {
                        policyText.classList.remove('dimmed');
                        state.textDimmed = false;
                    }
                }

                // éšæœºé€‰æ‹©ä¸€ä¸ªå¹²æ‰°å…ƒç´ é«˜äº®
                const randomIndex = Math.floor(Math.random() * distractionElements.length);
                const distraction = distractionElements[randomIndex];

                // è®¾ç½®é«˜äº®
                distraction.classList.add('highlighted');
                state.currentHighlighted = distraction;
                state.highlightedSidebarItems.add(distraction.id);

                // ä½¿ä¸»æ–‡æœ¬æš—æ·¡
                policyText.classList.add('dimmed');
                state.textDimmed = true;

                playHighlightSound();
                updateInputState();
            }

            // åˆå§‹å»¶è¿Ÿåå¼€å§‹
            setTimeout(() => {
                highlightRandomDistraction();
                state.highlightInterval = setInterval(() => {
                    if (state.started) {
                        const highlightChance = Math.min(90, state.baseHighlightChance + (state.chaosLevel * 0.3));
                        if (Math.random() * 100 < highlightChance) {
                            highlightRandomDistraction();
                        }
                    }
                }, 2000 + Math.random() * 3000);
            }, 1500);
        }

        function handleDistractionClick(distractionElement) {
            if (!state.started) return;

            if (distractionElement.classList.contains('highlighted')) {
                distractionElement.classList.remove('highlighted');
                state.highlightedSidebarItems.delete(distractionElement.id);

                if (distractionElement === state.currentHighlighted) {
                    state.currentHighlighted = null;
                }

                policyText.classList.remove('dimmed');
                state.textDimmed = false;

                state.distractionsClicked++;
                playFeedbackSound();
                state.chaosLevel = Math.max(0, state.chaosLevel - 8);

                updateInputState();
                updateVisuals();
            }
        }

        // --- å¹¿å‘Šç³»ç»Ÿ ---
        function startPopupAdSystem() {
            function spawnPopupAd() {
                if (!state.started) return;
                if (state.popupAds.length >= state.maxAds) return;

                const adData = popupAdsData[Math.floor(Math.random() * popupAdsData.length)];
                const adId = 'ad-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);

                const ad = document.createElement('div');
                ad.className = `popup-ad ad-type-${adData.type}`;
                ad.id = adId;

                // æ ¹æ®å¹¿å‘Šç±»å‹è·å–å¹¿å‘Šå°ºå¯¸
                let adWidth, adHeight;
                switch (adData.type) {
                    case 'standard':
                        adWidth = 220;
                        adHeight = 120;
                        break;
                    case 'banner':
                        adWidth = 300;
                        adHeight = 60;
                        break;
                    case 'circle':
                        adWidth = 100;
                        adHeight = 100;
                        break;
                    case 'countdown':
                        adWidth = 180;
                        adHeight = 130;
                        break;
                    case 'warning':
                        adWidth = 250;
                        adHeight = 120;
                        break;
                    case 'notification':
                        adWidth = 260;
                        adHeight = 140;
                        break;
                    case 'coupon':
                        adWidth = 240;
                        adHeight = 160;
                        break;
                    default:
                        adWidth = 200;
                        adHeight = 100;
                }

                // ç”Ÿæˆå¹¿å‘ŠHTML
                let adHTML = '';
                switch (adData.type) {
                    case 'standard':
                        adHTML = `
                                    <div class="popup-ad-close">Ã—</div>
                                    <div class="distraction-title" style="color: ${adData.textColor};">${adData.title}</div>
                                    <div class="distraction-content" style="color: ${adData.textColor};">${adData.content}</div>
                                `;
                        break;
                    case 'banner':
                        adHTML = `
                                    <div class="popup-ad-close">Ã—</div>
                                    <div style="font-size: 16px; font-weight: bold; color: ${adData.textColor};">${adData.title}</div>
                                    <div style="font-size: 12px; color: ${adData.textColor};">${adData.content}</div>
                                `;
                        break;
                    case 'circle':
                        adHTML = `
                                    <div class="popup-ad-close">Ã—</div>
                                    <div style="font-size: 18px; margin-bottom: 5px; color: ${adData.textColor};">${adData.title}</div>
                                    <div style="font-size: 12px; color: ${adData.textColor};">${adData.content}</div>
                                `;
                        break;
                    case 'countdown':
                        adHTML = `
                                    <div class="popup-ad-close">Ã—</div>
                                    <div class="distraction-title" style="color: ${adData.textColor};">${adData.title}</div>
                                    <div class="distraction-content" style="color: ${adData.textColor};">${adData.content}</div>
                                `;
                        break;
                    case 'warning':
                        adHTML = `
                                    <div class="popup-ad-close">Ã—</div>
                                    <div style="font-size: 18px; margin-bottom: 10px; color: ${adData.textColor};">âš ï¸ ${adData.title}</div>
                                    <div style="color: ${adData.textColor};">${adData.content}</div>
                                `;
                        break;
                    case 'notification':
                        adHTML = `
                                    <div class="popup-ad-close">Ã—</div>
                                    <div class="notification-icon">ğŸ””</div>
                                    <div class="distraction-title" style="color: ${adData.textColor};">${adData.title}</div>
                                    <div class="distraction-content" style="color: ${adData.textColor};">${adData.content}</div>
                                `;
                        break;
                    case 'coupon':
                        adHTML = `
                                    <div class="popup-ad-close">Ã—</div>
                                    <div class="distraction-title" style="color: ${adData.textColor};">${adData.title}</div>
                                    <div class="coupon-code">${adData.couponCode || "CODE2024"}</div>
                                    <div class="distraction-content" style="color: ${adData.textColor};">${adData.content}</div>
                                `;
                        break;
                }

                // ç¡®ä¿å¹¿å‘Šå†…å®¹ä¸ä¸ºç©º
                if (!adData.title || !adData.content) {
                    console.warn('å¹¿å‘Šæ•°æ®ä¸å®Œæ•´:', adData);
                    adData.title = adData.title || "é»˜è®¤æ ‡é¢˜";
                    adData.content = adData.content || "é»˜è®¤å†…å®¹";
                }

                ad.innerHTML = adHTML;
                ad.style.borderColor = adData.color;

                // è®¡ç®—å¹¿å‘Šä½ç½® - ç¡®ä¿åœ¨å¯è§†åŒºåŸŸå†…
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;

                // è®¡ç®—æœ€å¤§å¯ç”¨ä½ç½®ï¼Œç¡®ä¿å¹¿å‘Šå®Œå…¨åœ¨è§†çª—å†…
                const maxX = Math.max(0, viewportWidth - adWidth - 20);
                const maxY = Math.max(0, viewportHeight - adHeight - 20);

                // å¦‚æœè§†çª—å¤ªå°ï¼Œæ— æ³•å®¹çº³å¹¿å‘Šï¼Œåˆ™è°ƒæ•´å¹¿å‘Šå°ºå¯¸æˆ–è·³è¿‡
                if (maxX < 20 || maxY < 20) {
                    console.warn('è§†çª—å¤ªå°ï¼Œæ— æ³•å®¹çº³å¹¿å‘Šï¼Œè·³è¿‡ç”Ÿæˆ');
                    return;
                }

                // ç”Ÿæˆéšæœºä½ç½®ï¼Œç¡®ä¿åœ¨å¯è§†åŒºåŸŸå†…
                const randomX = Math.max(20, Math.min(maxX, Math.floor(Math.random() * maxX)));
                const randomY = Math.max(20, Math.min(maxY, Math.floor(Math.random() * maxY)));

                ad.style.left = `${randomX}px`;
                ad.style.top = `${randomY}px`;

                document.body.appendChild(ad);
                state.popupAds.push(ad);

                // æ¿€æ´»å¹¿å‘Š
                setTimeout(() => {
                    if (ad.parentNode) {
                        ad.classList.add('active');
                    }
                }, 100);

                // è®¾ç½®å…³é—­æŒ‰é’®äº‹ä»¶
                const closeBtn = ad.querySelector('.popup-ad-close');
                if (closeBtn) {
                    closeBtn.addEventListener('click', function (e) {
                        e.stopPropagation();
                        removeAd(ad);
                    });
                }

                // è®¾ç½®å¹¿å‘Šç‚¹å‡»äº‹ä»¶
                ad.addEventListener('click', function () {
                    handleAdClick(ad);
                });

                // éšæœºé«˜äº®å¹¿å‘Š
                const highlightDelay = 800 + Math.random() * 1200;
                const highlightTimer = setTimeout(() => {
                    if (state.started && ad.parentNode) {
                        const highlightChance = Math.min(80, 50 + (state.chaosLevel * 0.4));
                        if (Math.random() * 100 < highlightChance) {
                            highlightAd(ad);
                        }
                    }
                }, highlightDelay);

                state.adTimers.set(adId + '-highlight', highlightTimer);

                // è‡ªåŠ¨ç§»é™¤å¹¿å‘Š
                const autoRemoveTime = 6000 + Math.random() * 4000;
                const removeTimer = setTimeout(() => {
                    if (ad.parentNode && !state.highlightedAds.has(adId)) {
                        removeAd(ad);
                    }
                }, autoRemoveTime);

                state.adTimers.set(adId + '-remove', removeTimer);

                return adId;
            }

            function scheduleNextPopupAd() {
                if (!state.started) return;

                const spawnChance = Math.min(80, state.baseSpawnChance + (state.chaosLevel * 0.5));
                if (Math.random() * 100 < spawnChance) {
                    spawnPopupAd();
                }

                const nextInterval = Math.max(1000, state.spawnRateMs - (state.chaosLevel * 20)) * (0.6 + Math.random() * 0.8);
                setTimeout(scheduleNextPopupAd, nextInterval);
            }

            // åˆå§‹å¹¿å‘Š
            setTimeout(() => {
                spawnPopupAd();
                setTimeout(() => spawnPopupAd(), 800);
                scheduleNextPopupAd();
            }, 2000);
        }

        function highlightAd(adElement) {
            if (!state.started || !adElement.parentNode) return;

            adElement.classList.add('highlighted');
            state.highlightedAds.add(adElement.id);

            policyText.classList.add('dimmed');
            policyText.style.opacity = "0.2";

            playHighlightSound();
            updateInputState();
        }

        function handleAdClick(adElement) {
            if (!state.started) return;

            if (adElement.classList.contains('highlighted')) {
                adElement.classList.remove('highlighted');
                state.highlightedAds.delete(adElement.id);

                policyText.classList.remove('dimmed');
                policyText.style.opacity = "";

                state.distractionsClicked++;
                playFeedbackSound();
                state.chaosLevel = Math.max(0, state.chaosLevel - 5);

                updateInputState();
                updateVisuals();
            }

            // ç§»é™¤å¹¿å‘Š
            setTimeout(() => {
                removeAd(adElement);
            }, 300);
        }

        function removeAd(adElement) {
            if (!adElement || !adElement.parentNode) return;

            const adId = adElement.id;

            // å¦‚æœå¹¿å‘Šæ˜¯é«˜äº®çš„ï¼Œä»é«˜äº®é›†åˆä¸­ç§»é™¤
            if (adElement.classList.contains('highlighted')) {
                adElement.classList.remove('highlighted');
                state.highlightedAds.delete(adId);

                policyText.classList.remove('dimmed');
                policyText.style.opacity = "";
            }

            // æ›´æ–°è¾“å…¥çŠ¶æ€
            updateInputState();

            // ç§»é™¤å¹¿å‘Šå…ƒç´ 
            adElement.classList.remove('active');
            setTimeout(() => {
                if (adElement.parentNode) {
                    adElement.remove();

                    // ä»æ•°ç»„ä¸­ç§»é™¤
                    const index = state.popupAds.indexOf(adElement);
                    if (index > -1) state.popupAds.splice(index, 1);

                    // æ¸…ç†å®šæ—¶å™¨
                    ['-highlight', '-remove'].forEach(suffix => {
                        const timerKey = adId + suffix;
                        const timerId = state.adTimers.get(timerKey);
                        if (timerId) {
                            clearTimeout(timerId);
                            state.adTimers.delete(timerKey);
                        }
                    });
                }
            }, 300);
        }

        // --- æ··ä¹±å¼•æ“ ---
        function updateVisuals() {
            if (whiteNoiseGain) {
                whiteNoiseGain.gain.setTargetAtTime(0.02 + (state.chaosLevel / 2000), audioCtx.currentTime, 0.5);
            }

            state.spawnRateMs = Math.max(1200, 2500 - (state.chaosLevel * 25));
        }

        // --- éŸ³é¢‘ç³»ç»Ÿ ---
        function initAudio() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();

            // èƒŒæ™¯ç™½å™ªéŸ³
            const bufferSize = 2 * audioCtx.sampleRate;
            const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const output = noiseBuffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) { output[i] = Math.random() * 2 - 1; }
            const whiteNoise = audioCtx.createBufferSource();
            whiteNoise.buffer = noiseBuffer;
            whiteNoise.loop = true;
            whiteNoiseGain = audioCtx.createGain();
            whiteNoiseGain.gain.value = 0.02;
            whiteNoise.connect(whiteNoiseGain).connect(audioCtx.destination);
            whiteNoise.start();
        }

        function playHighlightSound() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'square';
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
            osc.connect(gain).connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        function playBlockedSound() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(300, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2);
            osc.connect(gain).connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.2);
        }

        function playFeedbackSound() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2);
            osc.connect(gain).connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.2);
        }

        // æ·»åŠ æŠ–åŠ¨åŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
                    @keyframes shake {
                        0%, 100% { transform: translateX(0); }
                        10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                        20%, 40%, 60%, 80% { transform: translateX(5px); }
                    }
                `;
        document.head.appendChild(style);

    </script>
</body>
</html>
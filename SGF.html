<!-- SGF SesoryGatingFailure  æ„Ÿå®˜é—¨æ§å¤±æ•ˆ-->
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è®¤çŸ¥ä¹‹çª— - æ„Ÿå®˜é—¨æ§å¤±æ•ˆæ¨¡æ‹Ÿ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #ff8447;
            --primary-light: #f4806c;
            --secondary: #f4806c;
            --accent: #ff6347;
            --accent-light: #ff9a76;
            --light: #faf9f8;
            --dark: #403e34;
            --gray: #7d786c;
            --light-gray: #efede9;
            --transition: all 0.3s ease;
            /* å¹²æ‰°å…ƒç´ é¢œè‰² */
            --distraction-color-1: #ff0055;
            --distraction-color-2: #00aaff;
            --distraction-color-3: #ffaa00;
            --distraction-color-4: #aa00ff;
            --distraction-color-5: #00ffaa;
            --distraction-color-6: #ff5500;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        html {
            overflow-x: hidden;
        }

        body {
            background-color: #fff2e5;
            color: var(--dark);
            line-height: 1.6;
            overflow: hidden;
            overflow-x: hidden;
            height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* å¤´éƒ¨å¯¼èˆª */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background-color: white;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
            z-index: 10000;
            padding: 0 20px;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .logo-icon {
            color: var(--primary);
            font-size: 28px;
        }

        .logo-text {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary);
        }

        .logo-subtitle {
            font-size: 14px;
            color: var(--gray);
            margin-top: -5px;
        }

        .cta-button {
            background-color: var(--accent);
            color: white;
            border: none;
            padding: 10px 24px;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-block;
        }

            .cta-button:hover {
                background-color: #ff4500;
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(255, 99, 71, 0.3);
            }

        /* ä¸»å®¹å™¨ */
        .container {
            position: relative;
            width: 90%;
            max-width: 1200px;
            height: 85vh;
            background: white;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            gap: 20px;
            opacity: 0.3;
            filter: blur(2px);
            transition: opacity 0.5s ease, filter 0.5s ease;
            margin-top: 90px; /* ä¸ºå¯¼èˆªæ ç•™å‡ºç©ºé—´ */
        }

            .container.active {
                opacity: 1;
                filter: blur(0);
            }

        /* æ ¸å¿ƒå†…å®¹åŒº */
        .content-layer {
            position: relative;
            z-index: 10;
            width: 65%;
            height: 100%;
            display: flex;
            flex-direction: column;
            transition: filter 0.3s ease-out, opacity 0.3s ease-out;
            filter: blur(0.5px);
        }

        /* å¹²æ‰°å…ƒç´ ä¾§è¾¹æ  */
        .distraction-sidebar {
            width: 35%;
            height: 100%;
            position: relative;
            background: var(--light);
            border-left: 1px solid var(--light-gray);
            padding: 15px;
            overflow-y: auto;
            border-radius: 8px;
        }

        h1 {
            color: var(--primary);
            border-bottom: 2px solid var(--light-gray);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .flight-info {
            background: #faf9f5;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 30px;
            font-weight: bold;
            color: var(--primary);
        }

        .policy-text {
            line-height: 2;
            font-size: 18px;
            color: #444;
            text-align: justify;
            flex-grow: 1;
            overflow-y: auto;
            padding-right: 10px;
            transition: opacity 0.5s ease, color 0.5s ease, filter 0.5s ease;
        }

        /* éšè—åœ¨æ­£æ–‡ä¸­çš„éªŒè¯ç æ ·å¼ */
        .hidden-code {
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            background: #f4f4f4;
            padding: 2px 5px;
            border-radius: 4px;
            border: 1px dashed #ccc;
            transition: all 0.3s ease;
        }

        .input-area {
            margin-top: auto;
            padding-top: 20px;
            border-top: 1px solid var(--light-gray);
            display: flex;
            gap: 10px;
            transition: opacity 0.3s ease;
            position: relative;
        }

        input[type="text"] {
            flex-grow: 1;
            padding: 12px;
            font-size: 16px;
            border: 2px solid var(--light-gray);
            border-radius: 6px;
            transition: all 0.3s ease;
            font-family: inherit;
        }

            input[type="text"]:disabled {
                background-color: #f5f5f5;
                color: #999;
                border-color: #ccc;
                cursor: not-allowed;
            }

        .btn {
            background: var(--primary);
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: var(--transition);
            font-family: inherit;
            font-weight: 600;
        }

            .btn:disabled {
                background: #cccccc;
                cursor: not-allowed;
            }

            .btn:hover:not(:disabled) {
                background: #e67347; /* æŒ‰é’®hoverçŠ¶æ€èƒŒæ™¯è‰² - æ·±æ©™è‰² */
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(255, 132, 71, 0.4); /* æŒ‰é’®hoveré˜´å½± - åŠé€æ˜æ©™è‰² */
            }

        /* ======= é™æ€å¹²æ‰°å…ƒç´  (ç½‘é¡µå†…å›ºå®šå¹²æ‰°) ======= */
        .static-distraction {
            background: white;
            border: 1px solid var(--light-gray);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
            transition: var(--transition);
            cursor: pointer;
            opacity: 0.9;
        }

            .static-distraction.highlighted {
                box-shadow: 0 0 25px rgba(255, 170, 0, 0.6);
                transform: scale(1.05);
                z-index: 100;
                position: relative;
                animation: glow-pulse 1.5s infinite alternate;
            }

        @keyframes glow-pulse {
            0% {
                box-shadow: 0 0 15px rgba(255, 170, 0, 0.5);
            }

            100% {
                box-shadow: 0 0 35px rgba(255, 170, 0, 0.7);
            }
        }

        .distraction-title {
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 16px;
        }

        .distraction-content {
            font-size: 14px;
            color: #666;
            line-height: 1.4;
        }

        /* ======= å¤šæ ·åŒ–å°å¹¿å‘Šæ ·å¼ ======= */
        /* åŸºç¡€å¹¿å‘Šæ ·å¼ */
        .popup-ad {
            position: absolute;
            z-index: 1000;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
            opacity: 0;
            transform: scale(0.9);
        }

            .popup-ad.active {
                opacity: 1;
                transform: scale(1);
            }

            .popup-ad.highlighted {
                border-color: currentColor;
                animation: popup-glow 1s infinite alternate;
                z-index: 1001;
            }

        @keyframes popup-glow {
            0% {
                box-shadow: 0 0 15px currentColor;
            }

            100% {
                box-shadow: 0 0 30px currentColor;
            }
        }

        .popup-ad-close {
            position: absolute;
            top: 5px;
            right: 10px;
            color: #fff;
            font-size: 20px;
            cursor: pointer;
            z-index: 10;
            background: rgba(0,0,0,0.3);
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
        }

            .popup-ad-close:hover {
                background: rgba(255,0,0,0.7);
                color: white;
            }

        /* ç±»å‹1: æ ‡å‡†çŸ©å½¢å¹¿å‘Š */
        .ad-type-standard {
            width: 220px;
            background: #6C71B7;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            padding: 15px;
        }

            .ad-type-standard .distraction-title {
                color: white;
            }

            .ad-type-standard .distraction-content {
                color: rgba(255,255,255,0.9);
            }

        /* ç±»å‹2: æ¨ªå¹…å¹¿å‘Š */
        .ad-type-banner {
            width: 300px;
            height: 60px;
            background: linear-gradient(45deg, #ff9966, #ff5e62);
            border-radius: 4px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            padding: 10px 15px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            color: white;
            font-weight: bold;
        }

            .ad-type-banner .distraction-title {
                color: white;
                font-size: 16px;
                margin-bottom: 0;
            }

            .ad-type-banner .distraction-content {
                color: rgba(255,255,255,0.9);
                font-size: 12px;
            }

        /* ç±»å‹3: åœ†å½¢å›¾æ ‡å¹¿å‘Š */
        .ad-type-circle {
            width: 150px;
            height: 150px;
            background: linear-gradient(45deg, #2193b0, #6dd5ed);
            border-radius: 50%;
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            text-align: center;
            padding: 10px;
        }

            .ad-type-circle .distraction-title {
                color: white;
                font-size: 18px;
                margin-bottom: 5px;
            }

            .ad-type-circle .distraction-content {
                color: rgba(255,255,255,0.9);
                font-size: 12px;
            }

        /* ç±»å‹4: æ ‡å‡†å¹¿å‘Šï¼ˆåŸå€’è®¡æ—¶å¹¿å‘Šï¼‰ */
        .ad-type-countdown {
            width: 180px;
            background: linear-gradient(45deg, #834d9b, #d04ed6);
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            padding: 15px;
            color: white;
            text-align: center;
        }

            .ad-type-countdown .distraction-title {
                color: white;
            }

            .ad-type-countdown .distraction-content {
                color: rgba(255,255,255,0.9);
            }

        /* ç±»å‹5: é—ªçƒè­¦å‘Šå¹¿å‘Š */
        .ad-type-warning {
            width: 250px;
            background: #ff4444;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            padding: 15px;
            color: white;
            text-align: center;
            animation: warning-blink 1s infinite;
        }

        @keyframes warning-blink {
            0%, 100% {
                background-color: #ff4444;
            }

            50% {
                background-color: #ff8888;
            }
        }

        .ad-type-warning .distraction-title {
            color: white;
        }

        .ad-type-warning .distraction-content {
            color: rgba(255,255,255,0.9);
        }

        /* ç±»å‹6: é€šçŸ¥å¡ç‰‡å¹¿å‘Š */
        .ad-type-notification {
            width: 260px;
            background: linear-gradient(45deg, #4CAF50, #8BC34A);
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            padding: 20px;
            color: white;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

            .ad-type-notification .notification-icon {
                font-size: 24px;
                margin-bottom: 10px;
                text-align: center;
            }

            .ad-type-notification .distraction-title {
                color: white;
                font-size: 18px;
                margin-bottom: 5px;
            }

            .ad-type-notification .distraction-content {
                color: rgba(255,255,255,0.9);
                font-size: 14px;
                line-height: 1.4;
            }

        /* ç±»å‹7: ä¼˜æƒ åˆ¸å¹¿å‘Š */
        .ad-type-coupon {
            width: 240px;
            background: white;
            border: 2px dashed #ff5500;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            padding: 15px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

            .ad-type-coupon::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 6px;
                background: linear-gradient(90deg, #ff5500, #ffaa00);
            }

            .ad-type-coupon .coupon-code {
                background: #fff8e6;
                border: 1px dashed #ffaa00;
                padding: 8px 12px;
                margin: 10px 0;
                font-family: 'Courier New', monospace;
                font-weight: bold;
                color: #ff5500;
                border-radius: 4px;
            }

            .ad-type-coupon .distraction-title {
                color: #ff5500;
                font-size: 18px;
                margin-bottom: 10px;
            }

            .ad-type-coupon .distraction-content {
                color: #666;
                font-size: 14px;
            }

        /* æš—æ·¡æ•ˆæœ */
        .dimmed {
            opacity: 0.3 !important;
            color: #888 !important;
            filter: blur(1.5px) !important;
        }

        /* è¾“å…¥æ¡†ç¦ç”¨è¦†ç›–å±‚ - ä¿®å¤ç‰ˆ */
        .input-overlay {
            position: absolute;
            inset: 0;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            z-index: 2000;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            border: 2px dashed #ff4444;
            font-weight: bold;
            color: #ff4444;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

            .input-overlay.active {
                opacity: 1;
            }

        /* å¼¹çª—æ ·å¼ */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 20000;
        }

        .modal {
            background: rgb(255, 252, 248);
            border-radius: 12px;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3);
            width: 90%;
            max-width: 700px;
            padding: 25px;
            position: relative;
            animation: modal-appear 0.4s ease-out;
        }

        @keyframes modal-appear {
            0% {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }

            100% {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .modal-header {
            margin-bottom: 15px;
            text-align: center;
        }

        .modal-title {
            color: var(--primary);
            font-size: 26px;
            margin: 0 0 8px 0;
        }

        .modal-subtitle {
            color: var(--gray);
            font-size: 15px;
            margin: 0;
        }

        .modal-content {
            line-height: 1.6;
            font-size: 15px;
            color: #444;
        }

        .modal-warning {
            background: #fff8e6;
            border-left: 4px solid #ffaa00;
            padding: 12px;
            margin: 15px 0;
            border-radius: 0 4px 4px 0;
        }

        .modal-highlight {
            color: #ff8528;
            font-weight: bold;
        }

        .modal-close-btn {
            background: linear-gradient(45deg,  #eacc23); /* å¼¹çª—"å¼€å§‹ä½“éªŒ"æŒ‰é’®æ¸å˜èƒŒæ™¯è‰² - æ©™è‰²åˆ°é‡‘é»„è‰² */
            color: white;
            border: none;
            padding: 12px 28px;
            font-size: 17px;
            border-radius: 8px;
            cursor: pointer;
            display: block;
            margin: 20px auto 0;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 140, 0, 0.3); /* å¼¹çª—æŒ‰é’®é˜´å½± - åŠé€æ˜æ©™è‰² */
            font-family: inherit;
            font-weight: 600;
        }

            .modal-close-btn:hover {
                transform: translateY(-2px);
                box-shadow: 0 6px 20px rgba(255, 140, 0, 0.5); /* å¼¹çª—æŒ‰é’®hoveré˜´å½± - åŠé€æ˜æ©™è‰² */
                background: linear-gradient(45deg, #ff7700, #ffc400); /* å¼¹çª—æŒ‰é’®hoveræ¸å˜èƒŒæ™¯è‰² - æ·±æ©™åˆ°äº®é»„ */
            }

        /* è¦†ç›–å±‚ (ç»“æœç•Œé¢) */
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.92);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 20000;
            text-align: center;
            padding: 20px;
        }

        .hidden {
            display: none !important;
        }

        .stats-highlight {
            font-size: 4em;
            color: var(--accent);
            font-weight: bold;
            display: block;
            margin: 20px 0;
        }

        /* ç»“æœé¡µé¢çš„æŒ‰é’®å®¹å™¨ */
        .result-buttons {
            display: flex;
            gap: 20px;
            margin-top: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

            .result-buttons .btn {
                min-width: 160px;
            }

        /* --- æ–°å¢ç»“æœé¡µæ ·å¼ --- */
        .result-content {
            max-width: 640px;
            text-align: center;
            padding: 0px;
        }

        .result-header i {
            font-size: 3rem;
            color: var(--primary);
            margin-bottom: 15px;
        }

        .stats-grid {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 25px 0;
            padding: 20px;
            background: #faf9f5;
            border-radius: 12px;
        }

        .stat-item {
            flex: 1;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            color: var(--primary);
        }

        .stat-label {
            font-size: 0.9rem;
            color: #666;
            margin-top: 5px;
        }

        .science-note {
            text-align: left;
            background: #faf9f5;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
            border-left: 5px solid var(--accent);
        }

            .science-note h3 {
                color: var(--secondary);
                margin-top: 0;
                margin-bottom: 10px;
                font-size: 1.1rem;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .science-note p {
                font-size: 0.95rem;
                line-height: 1.6;
                color: #444;
                margin-bottom: 8px;
            }

        .result-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

            /* æŒ‰é’®æ ·å¼å¾®è°ƒ */
            .result-actions .btn {
                padding: 15px 40px;
                font-size: 18px;
                border-radius: 35px;
                display: flex;
                align-items: center;
                gap: 8px;
                transition: all 0.3s ease;
            }
        /* ç§‘æ™®é¡µé¢æŒ‰é’®ç‰¹æ®Šæ ·å¼ */
        .btn-science {
            background: linear-gradient(45deg, #ff9944, #ff7722); /* "è¿›å…¥ç§‘æ™®é¡µé¢"æŒ‰é’®æ¸å˜èƒŒæ™¯è‰² - æ©™é»„åˆ°æ·±æ©™ */
        }

            .btn-science:hover {
                background: linear-gradient(45deg, #0088cc, #006699);
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0, 136, 204, 0.3);
            }

        /* å†è¯•ä¸€æ¬¡æŒ‰é’®ç‰¹æ®Šæ ·å¼ */
        .btn-retry {
            background: linear-gradient(45deg, #ff5500, #cc4400);
        }

            .btn-retry:hover {
                background: linear-gradient(45deg, #cc4400, #aa3300);
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(255, 85, 0, 0.3);
            }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
                height: auto;
                max-height: 85vh;
            }

            .content-layer {
                width: 100%;
                height: 60%;
            }

            .distraction-sidebar {
                width: 100%;
                height: 40%;
                border-left: none;
                border-top: 1px solid var(--light-gray);
            }

            .input-overlay {
                inset: 0;
                height: 100%;
            }

            .result-buttons {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <!-- å¤´éƒ¨å¯¼èˆª -->
    <div class="navbar">
        <div class="nav-container">
            <div class="logo">
                <div class="logo-icon">
                    <i class="fas fa-brain"></i>
                </div>
                <div>
                    <div class="logo-text">è®¤çŸ¥ä¹‹çª—</div>
                    <div class="logo-subtitle">ADHDç§‘æ™®ä½“éªŒå¹³å°</div>
                </div>
            </div>
            <a href="index.html" class="cta-button">
                <i class="fas fa-home"></i> è¿”å›é¦–é¡µ
            </a>
        </div>
    </div>

    <!-- å¼¹çª—æç¤ºç•Œé¢ -->
    <div id="start-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h1 class="modal-title"> èˆªç­æ”¹ç­¾éªŒè¯</h1>
                <p class="modal-subtitle">æ¨¡æ‹ŸADHDå¤§è„‘çš„æ„Ÿå®˜é—¨æ§å¤±æ•ˆä½“éªŒ</p>
            </div>

            <div class="modal-content">
                <div style="background: linear-gradient(135deg, #fff9f0 0%, #fffcf8 100%); padding: 14px 16px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #ff8447;">
                    <p style="margin: 0 0 8px 0; font-size: 14px; font-weight: 600; color: #403e34; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-tasks" style="color: #ff8447;"></i>
                        <span>ä»»åŠ¡è¯´æ˜</span>
                    </p>
                    <p style="margin: 0; font-size: 15px; line-height: 1.5;">
                        <span class="modal-highlight">è¯·ä»æ­£æ–‡ä¸­æ‰¾åˆ°éªŒè¯ç å¹¶è¾“å…¥éªŒè¯ç </span>
                    </p>
                </div>

                <div class="modal-warning" style="position: relative; overflow: hidden;">
                    <div style="position: absolute; top: 0; right: 0; width: 60px; height: 60px; background: radial-gradient(circle, rgba(255,170,0,0.1) 0%, transparent 70%); border-radius: 50%;"></div>
                    <p style="margin: 0 0 8px 0; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-exclamation-triangle" style="color: #ffaa00;"></i>
                        <span>æ ¸å¿ƒæœºåˆ¶</span>
                    </p>
                    <div style="padding-left: 8px; border-left: 2px solid #ffe8b3;">
                        <p style="margin: 0 0 6px 0; line-height: 1.5;">å½“å¹²æ‰°ä¿¡æ¯<strong style="color: #ff8447;">é«˜äº®é—ªçƒ</strong>æ—¶ï¼Œæ‚¨çš„æ³¨æ„åŠ›ä¼šè¢«å¼ºåˆ¶å¸å¼•ï¼</p>
                        <p style="margin: 0 0 6px 0; line-height: 1.5;">æ­¤æ—¶ä¸»æ–‡æœ¬ä¼šå˜æ¨¡ç³Šï¼Œä¸”<strong style="color: #ff6347;">æ— æ³•è¾“å…¥éªŒè¯ç </strong>ã€‚</p>
                        <p style="margin: 0; line-height: 1.5;">æ‚¨å¿…é¡»<strong style="color: #ff8447;">ç‚¹å‡»æˆ–å…³é—­</strong>é«˜äº®çš„æ‚å¿µæˆ–å¹¿å‘Šï¼Œæ‰èƒ½æ¢å¤ä¸“æ³¨ã€‚</p>
                    </div>
                </div>

               <div style="margin-top: 15px; padding: 12px 14px; background: #fffcfa; border-radius: 8px; border: 1px solid #f0e8dc; box-shadow: 0 2px 8px rgba(0,0,0,0.04);">
                    <p style="margin: 0 0 8px 0; font-size: 13px; color: #46423c; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-headphones-alt" style="color: #ff8447; font-size: 14px;"></i>
                        <strong style="color: #403e34;">æç¤ºï¼š</strong>
                        <span>ä¸ºè·å¾—å®Œæ•´ä½“éªŒï¼Œè¯·ä½©æˆ´è€³æœºæˆ–å¼€å¯éŸ³é‡</span>
                    </p>
                    <p style="margin: 0; font-size: 13px; color: #46423c; display: flex; align-items: center; gap: 8px;">
                        <i class="fas fa-clock" style="color: #ff8447; font-size: 14px;"></i>
                        <strong style="color: #403e34;">é¢„ä¼°æ—¶é—´ï¼š</strong>
                        <span>ç¬¬ä¸€æ¬¡ä½“éªŒçº¦1-3åˆ†é’Ÿ</span>
                    </p>
                </div>

                <button class="modal-close-btn" onclick="startSimulation()">
                    <i class="fas fa-plane-departure" ></i> å¼€å§‹ä½“éªŒ
                </button>

                <div style="text-align: center; margin-top: 12px;">
                    <button onclick="showQuickGuide()" style="background: none; border: none; color: #666; text-decoration: underline; cursor: pointer; font-size: 13px;">
                        æŸ¥çœ‹å¿«é€Ÿæ“ä½œæŒ‡å—
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- ç»“æœå¼¹çª—ç•Œé¢ -->
    <div id="result-screen" class="modal-overlay hidden">
        <div class="modal">
            <div class="modal-header">
                <h1 class="modal-title">ä½“éªŒç»“æŸ</h1>
                <p class="modal-subtitle">æ„Ÿå®˜é—¨æ§å¤±æ•ˆæ¨¡æ‹Ÿç»“æœ</p>
            </div>

            <div class="modal-content">
                <div class="result-content">
                    <div class="result-header">
                        <i class="fas fa-clipboard-check"></i>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-item">
                            <div class="stat-value" id="time-taken">0.0s</div>
                            <div class="stat-label">æ€»è€—æ—¶</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value" id="final-distraction-count">0</div>
                            <div class="stat-label">å¯¹æŠ—å¹²æ‰°æ¬¡æ•°</div>
                        </div>
                    </div>

                    <div class="science-note">
                        <h3><i class="fas fa-brain"></i> ç—‡çŠ¶è§£æï¼šæ„Ÿå®˜é—¨æ§å¤±æ•ˆ</h3>
                        <p>
                            åˆšæ‰çš„ä½“éªŒæ¨¡æ‹Ÿäº†ADHDæ‚£è€…<strong>æ„Ÿå®˜é—¨æ§å¤±æ•ˆ</strong>çš„ç—‡çŠ¶ã€‚
                        </p>
                        <p>
                            æ­£å¸¸çš„å¤§è„‘æ‹¥æœ‰"é—¨æ§"æœºåˆ¶ï¼Œèƒ½è‡ªåŠ¨è¿‡æ»¤èƒŒæ™¯å™ªéŸ³å’Œæ— å…³è§†è§‰åˆºæ¿€ã€‚å½“è¿™ä¸ªæœºåˆ¶å¤±æ•ˆæ—¶ï¼ˆSensory Gating Failureï¼‰ï¼Œæ‰€æœ‰çš„æ„Ÿå®˜è¾“å…¥ï¼ˆå¹¿å‘Šã€å™ªéŸ³ã€é¢œè‰²ï¼‰éƒ½ä¼šä»¥åŒç­‰ä¼˜å…ˆçº§æ¶Œå…¥å¤§è„‘ï¼Œå¯¼è‡´<strong>ä¿¡æ¯è¶…è½½</strong>ã€‚ç®€å•çš„ä»»åŠ¡ï¼ˆå¦‚è¾“å…¥éªŒè¯ç ï¼‰å› æ­¤å˜å¾—æåº¦è€—è´¹ç²¾åŠ›ä¸”éš¾ä»¥å®Œæˆã€‚
                        </p>
                    </div>

                    <div class="result-actions">
                        <button onclick="goToSciencePage()" class="btn btn-science">
                            <i class="fas fa-book-open"></i> æŸ¥çœ‹ç§‘æ™®
                        </button>
                        <button onclick="location.reload()" class="btn btn-retry">
                            <i class="fas fa-redo"></i> å†æ¬¡ä½“éªŒ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="container" id="main-container">
        <!-- ä¸»è¦å†…å®¹åŒº -->
        <div class="content-layer" id="main-content">
            <h1>èˆªç­æ”¹ç­¾æ”¿ç­–ç¡®è®¤å‡½</h1>
            <div class="flight-info">
                æ–‡æ¡£ç¼–å·ï¼šCA-2024-PS-78945 | ç”Ÿæˆæ—¥æœŸï¼š2024å¹´1æœˆ13æ—¥
            </div>
            <div class="policy-text" id="policy-text">
                <p>å°Šæ•¬çš„æ—…å®¢ï¼š</p>
                <p>æ‚¨å¥½ï¼æ„Ÿè°¢æ‚¨é€‰æ‹©æˆ‘ä»¬çš„èˆªç©ºæœåŠ¡ã€‚ä¸ºç¡®ä¿æ‚¨çš„æƒç›Šå¹¶è§„èŒƒåç»­æ“ä½œæµç¨‹ï¼Œç‰¹æ­¤ç¡®è®¤æœ¬æ¬¡èˆªç­æ”¹ç­¾ç›¸å…³æ”¿ç­–æ¡æ¬¾ã€‚æœ¬ç¡®è®¤å‡½æ‰€è½½å†…å®¹å‡ä¸ºæœ€ç»ˆåè®®ä¾æ®ï¼Œè¯·å¦¥å–„ä¿ç®¡ã€‚</p>

                <h3>ä¸€ã€æ”¹ç­¾åŸºæœ¬è§„åˆ™</h3>
                <p>
                    1. <strong>æ—¶é—´é™åˆ¶ï¼š</strong> æ”¹ç­¾ç”³è¯·é¡»åœ¨åŸèˆªç­èµ·é£å‰4å°æ—¶æäº¤ï¼Œç‰¹æ®Šèˆªçº¿ï¼ˆå¦‚å›½é™…é•¿é€”ã€ä»£ç å…±äº«èˆªç­ï¼‰éœ€æå‰24å°æ—¶ã€‚é€¾æœŸä»…å¯åœ¨æœºåœºæŸœå°åŠç†ï¼Œä¸”é€‚ç”¨æ›´é«˜è´¹ç‡ã€‚<br>
                    2. <strong>è´¹ç”¨æ ‡å‡†ï¼š</strong> åŒèˆ±ä½æ”¹ç­¾æ”¶å–ç¥¨é¢ä»·æ ¼10%ä½œä¸ºæ‰‹ç»­è´¹ï¼›èˆ±ä½å‡çº§éœ€è¡¥è¶³ä»·å·®å¹¶åŠ æ”¶5%æœåŠ¡è´¹ï¼›é™çº§æ”¹ç­¾é€€è¿˜å·®ä»·ä½†æ”¶å–15%è¿çº¦é‡‘ã€‚ç‰¹ä»·æœºç¥¨ã€é‡Œç¨‹å…‘æ¢ç¥¨åŠå›¢ä½“ç¥¨å¯èƒ½ä¸é€‚ç”¨å…è´¹æ”¹ç­¾æ”¿ç­–ã€‚<br>
                    3. <strong>èˆªç­é€‰æ‹©ï¼š</strong> ä»…å¯æ”¹ç­¾åˆ°ç›¸åŒèˆªçº¿çš„åç»­èˆªç­ï¼Œä¸”ç›®æ ‡èˆªç­éœ€æœ‰å¯å”®åº§ä½ã€‚è‹¥åŸèˆ±ä½å·²æ»¡ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨æ¨èç›¸é‚»èˆ±ä½é€‰é¡¹ã€‚
                </p>
                ã€

                <h3>äºŒã€ç‰¹æ®Šæƒ…å½¢å¤„ç†</h3>
                <p>å› èˆªç©ºå…¬å¸åŸå› ï¼ˆå¦‚èˆªç­å–æ¶ˆã€æ—¶åˆ»è°ƒæ•´è¶…è¿‡2å°æ—¶ï¼‰å¯¼è‡´çš„æ”¹ç­¾ï¼Œæ—…å®¢å¯å…æ‰‹ç»­è´¹åŠç†ä¸€æ¬¡ï¼Œæˆ–é€‰æ‹©å…¨é¢é€€ç¥¨ã€‚å¤©æ°”ã€ç©ºç®¡ç­‰ä¸å¯æŠ—åŠ›å› ç´ é€ æˆçš„æ”¹ç­¾ï¼Œä¾æ®æ°‘èˆªå±€ç›¸å…³è§„å®šæ‰§è¡Œï¼Œè´¹ç”¨å¯åå•†å‡å…ä½†éå¼ºåˆ¶æ€§ã€‚æ—…å®¢å› å¥åº·åŸå› ç”³è¯·æ”¹ç­¾ï¼Œéœ€æä¾›äºŒçº§ç”²ç­‰ä»¥ä¸ŠåŒ»é™¢è¯æ˜ï¼Œå¯é…Œæƒ…å‡å…50%æ‰‹ç»­è´¹ã€‚</p>
                <h3>ä¸‰ã€ç¡®è®¤ä¸æ‰¿è¯º</h3>
                <p>æœ¬äººå·²è¯¦ç»†é˜…è¯»å¹¶å®Œå…¨ç†è§£ä¸Šè¿°æ”¹ç­¾æ”¿ç­–ï¼Œè‡ªæ„¿ç”³è¯·å¯¹è®¢å•å·CA20240113BJSHçš„èˆªç­è¿›è¡Œæ”¹ç­¾æ“ä½œã€‚ç¡®è®¤æœ¬å‡½éªŒè¯ç  <span class="hidden-code" id="target-code">07FPL6</span> çœŸå®æœ‰æ•ˆï¼ŒåŒæ„éµå®ˆèˆªç©ºå…¬å¸ä¸€åˆ‡åˆç†è§„å®šï¼Œå¹¶æ‰¿æ‹…ç›¸åº”è´¹ç”¨ã€‚åç»­æ‰€æœ‰æ²Ÿé€šå‡ä»¥æœ¬ç¡®è®¤å‡½è®°è½½å†…å®¹ä¸ºå‡†ï¼Œå£å¤´æ‰¿è¯ºæ— æ•ˆã€‚</p>
                <p style="margin-top: 20px; font-size: 0.9em; color: #666;">å®¢æœå·¥å·ï¼šCS240113-008 | å¤æ ¸æ—¶é—´ï¼š2024å¹´1æœˆ13æ—¥ 14:30:22</p>
            </div>

            <div class="input-area">
                <input type="text" id="captcha-input" placeholder="è¯·è¾“å…¥éªŒè¯ç ..." oncopy="return false" oncut="return false" onpaste="return false" oncontextmenu="return false" ondragstart="return false" onselectstart="return true">
                <button class="btn" id="submit-btn" onclick="checkCaptcha()">æäº¤éªŒè¯</button>
                <!-- è¾“å…¥æ¡†ç¦ç”¨è¦†ç›–å±‚ -->
                <div class="input-overlay" id="input-overlay">
                    <span>âš ï¸ è¯·å…ˆæ¶ˆé™¤æ‚å¿µï¼</span>
                </div>
            </div>
        </div>

        <!-- å¹²æ‰°å…ƒç´ ä¾§è¾¹æ  -->
        <div class="distraction-sidebar" id="distraction-sidebar">
            <h3 style="margin-top: 0; color: var(--gray);">ç›¸å…³æ¨èä¸é€šçŸ¥</h3>

            <div class="static-distraction" id="distraction-1" data-color="#ff0055">
                <div class="distraction-title">â— ç´§æ€¥ç³»ç»Ÿé€šçŸ¥</div>
                <div class="distraction-content">æ‚¨çš„è´¦æˆ·å®‰å…¨ç­‰çº§è¾ƒä½ï¼Œå»ºè®®ç«‹å³å‡çº§é˜²æŠ¤ã€‚æ£€æµ‹åˆ°3æ¬¡å¼‚å¸¸ç™»å½•å°è¯•ï¼Œè¯·éªŒè¯èº«ä»½ã€‚</div>
            </div>

            <div class="static-distraction" id="distraction-2" data-color="#00aaff">
                <div class="distraction-title">ğŸ”¥ çƒ­é—¨æ—…æ¸¸æ¨è</div>
                <div class="distraction-content">å·´å˜å²›7æ—¥è±ªåæ¸¸ä»…Â¥3999ï¼é™æ—¶ç‰¹æƒ ï¼ŒåŒ…å«æœºç¥¨é…’åº—ã€‚å‰©ä½™åé¢ï¼š12ä¸ªã€‚</div>
            </div>

            <div class="static-distraction" id="distraction-3" data-color="#ffaa00">
                <div class="distraction-title">ğŸ“§ æœªè¯»æ¶ˆæ¯ (3)</div>
                <div class="distraction-content">æ‚¨æœ‰3æ¡æœªè¯»æ¶ˆæ¯ï¼Œå…¶ä¸­1æ¡æ ‡è®°ä¸ºé‡è¦ã€‚æ¥è‡ªï¼šå®¢æœä¸­å¿ƒã€ä¿ƒé”€æ´»åŠ¨ã€ç³»ç»Ÿé€šçŸ¥ã€‚</div>
            </div>

            <div class="static-distraction" id="distraction-4" data-color="#aa00ff">
                <div class="distraction-title">ğŸ° å°æ¸¸æˆæ¨è</div>
                <div class="distraction-content">ä¼‘æ¯ä¸€ä¸‹ï¼Ÿè¯•è¯•æˆ‘ä»¬çš„æ—…è¡Œå°æ¸¸æˆï¼Œæœ‰æœºä¼šèµ¢å–1000é‡Œç¨‹ç§¯åˆ†ï¼ç‚¹å‡»å¼€å§‹ã€‚</div>
            </div>

            <div class="static-distraction" id="distraction-5" data-color="#00ffaa">
                <div class="distraction-title">ğŸ“Š æ•°æ®åˆ†ææŠ¥å‘Š</div>
                <div class="distraction-content">æ ¹æ®æ‚¨çš„æµè§ˆè®°å½•ï¼Œæˆ‘ä»¬ä¸ºæ‚¨æ¨èäº†5ä¸ªç›¸ä¼¼ç›®çš„åœ°ã€‚78%çš„ç”¨æˆ·å¯¹è¿™äº›æ¨èæ„Ÿå…´è¶£ã€‚</div>
            </div>

            <div class="static-distraction" id="distraction-6" data-color="#ff5500">
                <div class="distraction-title">âš ï¸ æµè§ˆå™¨è­¦å‘Š</div>
                <div class="distraction-content">æ£€æµ‹åˆ°æ‚¨çš„æµè§ˆå™¨ç‰ˆæœ¬è¾ƒä½ï¼Œå¯èƒ½å­˜åœ¨å®‰å…¨é£é™©ã€‚å»ºè®®ç«‹å³æ›´æ–°ä»¥è·å¾—æ›´å¥½ä½“éªŒã€‚</div>
            </div>
        </div>
    </div>

    <script>
        // --- é…ç½®çŠ¶æ€ ---
        let state = {
            started: false,
            startTime: 0,
            chaosLevel: 0,
            distractionsClicked: 0,
            textDimmed: false,
            currentHighlighted: null, // æŒ‡å‘ä¾§è¾¹æ é«˜äº®å…ƒç´ 
            popupAds: [],
            spawnRateMs: 2500,
            highlightInterval: null,
            watchdogInterval: null, // æ–°å¢ï¼šçœ‹é—¨ç‹—å®šæ—¶å™¨
            inputBlocked: false,
            highlightedAds: new Set(),         // è®°å½•é«˜äº®çš„å¹¿å‘ŠID
            highlightedSidebarItems: new Set(), // è®°å½•é«˜äº®çš„ä¾§è¾¹æ ID
            adTimers: new Map(),
            maxAds: 6,
            baseSpawnChance: 50,
            baseHighlightChance: 70
        };

        const correctCaptcha = "07FPL6";
        const distractionElements = [];
        const policyText = document.getElementById('policy-text');
        const captchaInput = document.getElementById('captcha-input');
        const submitBtn = document.getElementById('submit-btn');
        const inputOverlay = document.getElementById('input-overlay');
        const targetCode = document.getElementById('target-code');
        const mainContainer = document.getElementById('main-container');
        const startModal = document.getElementById('start-modal');

        // å¹¿å‘Šæ•°æ® (6ä¸ªå¹¿å‘Š + 6ä¸ªå†…å¿ƒæ‚å¿µ)
        const popupAdsData = [
            // ======== å¹¿å‘Šç±»ï¼ˆå‰6ä¸ªï¼‰ ========
            { type: "standard", title: "é™æ—¶ç‰¹æƒ ï¼", content: "æœºç¥¨ç›´é™50%ï¼ç‚¹å‡»é¢†å–ä¼˜æƒ åˆ¸", color: "#ff0055", textColor: "#333333" },
            { type: "banner", title: "å…è´¹å‡èˆ±æœºä¼š", content: "ç‚¹å‡»å‚ä¸æŠ½å¥–ï¼Œèµ¢å–å…è´¹å‡èˆ±ï¼", color: "#00aaff", textColor: "#ffffff" },
            { type: "coupon", title: "ä¸“å±ä¼˜æƒ åˆ¸", content: "ç«‹å³ä½¿ç”¨ï¼Œç«‹å‡200å…ƒ", couponCode: "FLY200", color: "#ff5500", textColor: "#333333" },
            { type: "standard", title: "æ–°ç”¨æˆ·ä¸“äº«", content: "æ³¨å†Œå³é€200å…ƒä¼˜æƒ åˆ¸", color: "#ff5500", textColor: "#333333" },
            { type: "banner", title: "ä¼šå‘˜ä¸“å±", content: "ä¼šå‘˜æ—¥å…¨åœº8æŠ˜ï¼Œä»…é™ä»Šå¤©", color: "#aa00ff", textColor: "#ffffff" },
            { type: "notification", title: "ç§¯åˆ†æ¸…é›¶æé†’", content: "æ‚¨çš„ç§¯åˆ†å³å°†è¿‡æœŸï¼Œå¿«å…‘æ¢ç¤¼å“", color: "#4CAF50", textColor: "#ffffff" },

            // ======== å†…å¿ƒæ‚å¿µç±»ï¼ˆå6ä¸ªï¼‰ ========
            { type: "warning", title: "å®Œè›‹äº†ï¼", content: "æˆ‘åˆšæ‰æ˜¯ä¸æ˜¯åˆè¯´é”™è¯äº†ï¼Ÿä»–ä»¬ä¼šæ€ä¹ˆçœ‹æˆ‘", color: "#666666", textColor: "#ffffff" },
            { type: "notification", title: "æ€ä¹ˆåŠï¼", content: "æŠ¥å‘Šè¿˜æ²¡å†™ï¼Œé‚®ä»¶æ²¡å›ï¼Œè¿˜æœ‰é‚£ä¸ª...åˆ°åº•æ˜¯ä»€ä¹ˆäº‹æ¥ç€ï¼Ÿ", color: "#9C27B0", textColor: "#ffffff" },
            { type: "circle", title: "Îµ=(Â´Î¿ï½€*)))å”‰", content: "å¥½æ— èŠå•Šï¼Œå¿…é¡»æ‰¾ç‚¹åˆºæ¿€çš„äº‹åš", color: "#FF9800", textColor: "#ffffff" },
            { type: "countdown", title: "å•Šï¼Ÿ", content: "å·²ç»ä¸‹åˆ3ç‚¹äº†ï¼Ÿä½†æ„Ÿè§‰ä»€ä¹ˆéƒ½æ²¡åš", color: "#795548", textColor: "#ffffff" },
            { type: "warning", title: "æ€ä¹ˆå›äº‹", content: "é‚£ä¸ªäººåˆšæ‰ç¬‘äº†ï¼Œæ˜¯ä¸æ˜¯åœ¨å˜²ç¬‘æˆ‘ï¼Ÿ", color: "#607D8B", textColor: "#ffffff" },
            { type: "standard", title: "å—¯ã€‚ã€‚ã€‚", content: "æ™šé¥­åƒä»€ä¹ˆï¼Ÿ", color: "#424242", textColor: "#ffffff" }
        ];

        // Audio Context
        let audioCtx;
        let whiteNoiseGain;

        // --- æ ¸å¿ƒæµç¨‹ ---

        function startSimulation() {
            startModal.classList.add('hidden');
            mainContainer.classList.add('active');

            state.started = true;
            state.startTime = Date.now(); // <--- æ–°å¢è¿™ä¸€è¡Œï¼šè®°å½•å¼€å§‹æ—¶é—´æˆ³
            initAudio();

            // æ”¶é›†æ‰€æœ‰é™æ€å¹²æ‰°å…ƒç´ 
            for (let i = 1; i <= 6; i++) {
                const el = document.getElementById(`distraction-${i}`);
                distractionElements.push(el);
                // ç§»é™¤æ—§çš„ç›‘å¬å™¨ä»¥é˜²é‡å¤ç»‘å®š
                const newEl = el.cloneNode(true);
                el.parentNode.replaceChild(newEl, el);
                distractionElements[i - 1] = newEl; // æ›´æ–°å¼•ç”¨

                newEl.addEventListener('click', function () {
                    handleDistractionClick(this);
                });
            }

            startHighlightSystem();
            startPopupAdSystem();
            startWatchdog(); // å¯åŠ¨çŠ¶æ€è‡ªæ„ˆç³»ç»Ÿ
            updateInputState();
            
            // ç¦æ­¢è¾“å…¥æ¡†å¤åˆ¶åŠŸèƒ½
            captchaInput.addEventListener('copy', function(e) {
                e.preventDefault();
                showTemporaryMessage('ç¦æ­¢å¤åˆ¶éªŒè¯ç ï¼', 'warning');
            });
            
            captchaInput.addEventListener('cut', function(e) {
                e.preventDefault();
                showTemporaryMessage('ç¦æ­¢å‰ªåˆ‡éªŒè¯ç ï¼', 'warning');
            });
            
            captchaInput.addEventListener('paste', function(e) {
                e.preventDefault();
                showTemporaryMessage('ç¦æ­¢ç²˜è´´éªŒè¯ç ï¼', 'warning');
            });
            
            captchaInput.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });
            
            // ç¦æ­¢é”®ç›˜å¿«æ·é”®ï¼ˆCtrl+C, Ctrl+X, Ctrl+Vï¼‰
            captchaInput.addEventListener('keydown', function(e) {
                if ((e.ctrlKey || e.metaKey) && (e.key === 'c' || e.key === 'x' || e.key === 'v' || e.key === 'C' || e.key === 'X' || e.key === 'V')) {
                    e.preventDefault();
                    showTemporaryMessage('ç¦æ­¢ä½¿ç”¨å¤åˆ¶/å‰ªåˆ‡/ç²˜è´´å¿«æ·é”®ï¼', 'warning');
                }
            });
        }
            

        function stopSimulation() {
            state.started = false;
            if (audioCtx) audioCtx.close();

            clearInterval(state.highlightInterval);
            clearInterval(state.watchdogInterval);

            state.adTimers.forEach(timerId => clearTimeout(timerId));
            state.adTimers.clear();

            document.querySelectorAll('.popup-ad').forEach(el => el.remove());

            // è®¡ç®—è€—æ—¶
            const endTime = Date.now();
            const timeTaken = ((endTime - state.startTime) / 1000).toFixed(1);

            // å¡«å……æ•°æ®åˆ°ç»“æœå¼¹çª—
            document.getElementById('time-taken').innerText = timeTaken + "s";
            document.getElementById('final-distraction-count').innerText = state.distractionsClicked;

            // æ˜¾ç¤ºç»“æœå¼¹çª—
            document.getElementById('result-screen').classList.remove('hidden');
        }

        // æ–°å¢å¿«é€Ÿæ“ä½œæŒ‡å—å¼¹çª—
        function showQuickGuide() {
            const guideModal = document.createElement('div');
            guideModal.className = 'modal-overlay';
            guideModal.style.zIndex = '20001';

            guideModal.innerHTML = `
            <div class="modal" style="max-width: 500px;">
                <div class="modal-header">
                    <h2 class="modal-title">ğŸ“ å¿«é€Ÿæ“ä½œæŒ‡å—</h2>
                    <p class="modal-subtitle">å¦‚ä½•åœ¨å¹²æ‰°ä¸­æ‰¾åˆ°éªŒè¯ç </p>
                </div>
                <div class="modal-content">
                    <div style="display: flex; align-items: center; margin-bottom: 15px; padding: 10px; background: #f0f9ff; border-radius: 6px;">
                        <div style="font-size: 24px; margin-right: 15px;">ğŸ”</div>
                        <div>
                            <strong>ç¬¬ä¸€æ­¥ï¼šå¯»æ‰¾éªŒè¯ç </strong>
                            <p style="margin: 5px 0 0 0; font-size: 14px; color: #666;">åœ¨æ”¿ç­–æ–‡ä»¶ä¸­å¯»æ‰¾</p>
                        </div>
                    </div>

                    <div style="display: flex; align-items: center; margin-bottom: 15px; padding: 10px; background: #fff8e6; border-radius: 6px;">
                        <div style="font-size: 24px; margin-right: 15px;">ğŸ¯</div>
                        <div>
                            <strong>ç¬¬äºŒæ­¥ï¼šæ¶ˆé™¤é«˜äº®å¹²æ‰°</strong>
                            <p style="margin: 5px 0 0 0; font-size: 14px; color: #666;">å½“å³ä¾§ä¿¡æ¯æˆ–æ‚å¿µé—ªçƒæ—¶ï¼Œå¿…é¡»ç‚¹å‡»å®ƒä»¬æ‰èƒ½ç»§ç»­</p>
                        </div>
                    </div>

                    <div style="display: flex; align-items: center; margin-bottom: 20px; padding: 10px; background: #f6ffed; border-radius: 6px;">
                        <div style="font-size: 24px; margin-right: 15px;">âŒ¨ï¸</div>
                        <div>
                            <strong>ç¬¬ä¸‰æ­¥ï¼šè¾“å…¥å¹¶æäº¤</strong>
                            <p style="margin: 5px 0 0 0; font-size: 14px; color: #666;">éªŒè¯ç ä¸º6ä½å¤§å†™å­—æ¯æ•°å­—ç»„åˆ</p>
                        </div>
                    </div>

                    <button onclick="this.closest('.modal-overlay').remove()" class="btn" style="display: block; margin: 0 auto; padding: 10px 25px;">
                        è¿”å›ä¸»ç•Œé¢
                    </button>
                </div>
            </div>
        `;

            document.body.appendChild(guideModal);
        }

        // --- æ–°å¢ï¼šçŠ¶æ€è‡ªæ„ˆç³»ç»Ÿ (Watchdog) ---
        // è¿™æ˜¯è§£å†³"æ— æ³•è¾“å…¥"é—®é¢˜çš„æ ¸å¿ƒï¼šå®šæœŸæ£€æŸ¥å®é™…DOMä¸çŠ¶æ€æ˜¯å¦ä¸€è‡´
        function startWatchdog() {
            state.watchdogInterval = setInterval(() => {
                if (!state.started) return;

                // 1. æ£€æŸ¥DOMä¸­å®é™…å­˜åœ¨çš„é«˜äº®å…ƒç´ æ•°é‡
                const domHighlightedAds = document.querySelectorAll('.popup-ad.highlighted').length;
                const domHighlightedSidebar = document.querySelectorAll('.static-distraction.highlighted').length;
                const totalHighlighted = domHighlightedAds + domHighlightedSidebar;

                // 2. æ£€æŸ¥æ˜¯å¦æœ‰å±å¹•å¤–çš„é«˜äº®å¹¿å‘Šå¹¶è‡ªåŠ¨ç§»é™¤
                document.querySelectorAll('.popup-ad.highlighted').forEach(ad => {
                    const rect = ad.getBoundingClientRect();
                    const isOutOfView = rect.right < 0 || rect.bottom < 0 || 
                                       rect.left > window.innerWidth || 
                                       rect.top > window.innerHeight;
                    
                    if (isOutOfView) {
                        console.log("æ£€æµ‹åˆ°å±å¹•å¤–çš„é«˜äº®å¹¿å‘Šï¼Œè‡ªåŠ¨ç§»é™¤:", ad.id);
                        ad.classList.remove('highlighted');
                        state.highlightedAds.delete(ad.id);
                        // ç›´æ¥ç§»é™¤è¿™ä¸ªå¹¿å‘Š
                        removeAd(ad);
                    }
                });
                
                // 2.1 é¢å¤–æ£€æŸ¥ï¼šç§»é™¤æ‰€æœ‰å±å¹•å¤–çš„å¹¿å‘Šï¼ˆåŒ…æ‹¬æœªé«˜äº®çš„ï¼‰
                document.querySelectorAll('.popup-ad').forEach(ad => {
                    const rect = ad.getBoundingClientRect();
                    const isOutOfView = rect.right < 0 || rect.bottom < 0 || 
                                       rect.left > window.innerWidth || 
                                       rect.top > window.innerHeight;
                    
                    if (isOutOfView && ad.parentNode) {
                        console.log("æ£€æµ‹åˆ°å±å¹•å¤–çš„æ™®é€šå¹¿å‘Šï¼Œè‡ªåŠ¨ç§»é™¤:", ad.id);
                        removeAd(ad);
                    }
                });

                // 3. å¦‚æœDOMä¸­æ²¡æœ‰é«˜äº®å…ƒç´ ï¼Œä½†è¾“å…¥æ¡†è¢«é”äº†ï¼Œå¼ºåˆ¶é‡ç½®çŠ¶æ€
                if (totalHighlighted === 0 && state.inputBlocked) {
                    console.log("æ£€æµ‹åˆ°çŠ¶æ€ä¸åŒæ­¥ï¼Œå¼ºåˆ¶è§£é”è¾“å…¥æ¡†");
                    state.highlightedAds.clear();
                    state.highlightedSidebarItems.clear();
                    state.currentHighlighted = null;
                    policyText.classList.remove('dimmed');
                    state.textDimmed = false;
                    updateInputState();
                }

                // 4. åŒæ­¥Setå’ŒDOM (é˜²æ­¢Setä¸­æœ‰æ®‹ç•™ID)
                if (state.highlightedAds.size > domHighlightedAds) {
                    // ç®€å•çš„æ¸…ç†ç­–ç•¥ï¼šå¦‚æœSetæ¯”DOMå¤šï¼Œè¯´æ˜æœ‰åƒµå°¸ID
                    // éå†Setï¼Œå¦‚æœæ‰¾ä¸åˆ°å¯¹åº”DOMï¼Œåˆ é™¤ä¹‹
                    for (let id of state.highlightedAds) {
                        const el = document.getElementById(id);
                        if (!el || !el.classList.contains('highlighted')) {
                            state.highlightedAds.delete(id);
                        }
                    }
                    updateInputState();
                }
            }, 500); // æ¯0.5ç§’æ£€æŸ¥ä¸€æ¬¡
        }

        function checkCaptcha() {
            if (state.inputBlocked) {
                playBlockedSound();
                return;
            }

            const input = document.getElementById('captcha-input').value.trim(); // å¢åŠ trim
            if (input.toUpperCase() === correctCaptcha) {
                stopSimulation();
            } else {
                alert("éªŒè¯ç é”™è¯¯ã€‚è¯·åœ¨æ­£æ–‡ä¸­ä»”ç»†å¯»æ‰¾ã€‚");
                state.chaosLevel += 10;
                updateVisuals();

                targetCode.style.color = "#ff4444";
                targetCode.style.backgroundColor = "#ffe6e6";
                targetCode.style.transform = "translateX(5px)";
                setTimeout(() => {
                    targetCode.style.transform = "translateX(-5px)";
                    setTimeout(() => {
                        targetCode.style.transform = "translateX(0)";
                        setTimeout(() => {
                            targetCode.style.color = "";
                            targetCode.style.backgroundColor = "";
                        }, 300);
                    }, 100);
                }, 100);
            }
        }

        function goToSciencePage() {
            // è·³è½¬åˆ°ç§‘æ™®é¡µé¢çš„æ„Ÿå®˜é—¨æ§ç« èŠ‚
            window.location.href = "kepu_1.html#sgf";
        }

        // --- è¾“å…¥çŠ¶æ€æ§åˆ¶ ---
        function updateInputState() {
            // åŒé‡æ£€æŸ¥ï¼šSetä¸­æœ‰æ•°æ® OR DOMä¸­æœ‰é«˜äº®ç±»å
            const hasHighlightedElements = state.highlightedAds.size > 0 ||
                state.highlightedSidebarItems.size > 0 ||
                document.querySelectorAll('.highlighted').length > 0;

            if (hasHighlightedElements) {
                state.inputBlocked = true;
                captchaInput.disabled = true;
                submitBtn.disabled = true;
                inputOverlay.classList.add('active');

                // åªæœ‰åˆšé”å®šæ—¶æ‰æŠ–åŠ¨ï¼Œé¿å…é¢‘ç¹æŠ–åŠ¨
                if (captchaInput.style.borderColor !== "rgb(255, 68, 68)") {
                    captchaInput.style.borderColor = "#ff4444";
                }
            } else {
                state.inputBlocked = false;
                captchaInput.disabled = false;
                submitBtn.disabled = false;
                inputOverlay.classList.remove('active');
                captchaInput.style.borderColor = "#ddd";
            }
        }

        // --- é«˜äº®ç³»ç»Ÿ ---
        function startHighlightSystem() {
            function highlightRandomDistraction() {
                if (!state.started) return;

                // å¼ºåˆ¶æ¸…ç†ä¹‹å‰çš„çŠ¶æ€ï¼Œé˜²æ­¢ä¾§è¾¹æ é€»è¾‘æ­»é”
                if (state.currentHighlighted) {
                    state.currentHighlighted.classList.remove('highlighted');
                    state.highlightedSidebarItems.delete(state.currentHighlighted.id);
                }
                // é¢å¤–æ¸…ç†ï¼šç¡®ä¿æ²¡æœ‰æ®‹ç•™çš„sidebaré«˜äº®
                document.querySelectorAll('.static-distraction.highlighted').forEach(el => {
                    el.classList.remove('highlighted');
                    state.highlightedSidebarItems.delete(el.id);
                });

                // è·å–ä¾§è¾¹æ å®¹å™¨
                const sidebar = document.getElementById('distraction-sidebar');
                if (!sidebar) return;

                // ç­›é€‰å¯è§çš„å¹²æ‰°å…ƒç´ 
                const visibleDistractions = distractionElements.filter(distraction => {
                    const rect = distraction.getBoundingClientRect();
                    const sidebarRect = sidebar.getBoundingClientRect();
                    
                    // æ£€æŸ¥å…ƒç´ æ˜¯å¦åœ¨ä¾§è¾¹æ çš„å¯è§†åŒºåŸŸå†…
                    return rect.top >= sidebarRect.top && 
                           rect.bottom <= sidebarRect.bottom && 
                           rect.top < sidebarRect.bottom;
                });

                // å¦‚æœæ²¡æœ‰å¯è§å…ƒç´ ï¼Œä¸é«˜äº®
                if (visibleDistractions.length === 0) return;

                // ä»å¯è§å…ƒç´ ä¸­éšæœºé€‰æ‹©
                const randomIndex = Math.floor(Math.random() * visibleDistractions.length);
                const distraction = visibleDistractions[randomIndex];

                distraction.classList.add('highlighted');
                state.currentHighlighted = distraction;
                state.highlightedSidebarItems.add(distraction.id);

                policyText.classList.add('dimmed');
                state.textDimmed = true;

                playHighlightSound();
                updateInputState();
            }

            setTimeout(() => {
                highlightRandomDistraction();
                state.highlightInterval = setInterval(() => {
                    if (state.started) {
                        const highlightChance = Math.min(90, state.baseHighlightChance + (state.chaosLevel * 0.3));
                        // æ£€æŸ¥å½“å‰æ˜¯å¦å·²ç»æœ‰é«˜äº®ï¼Œé¿å…é‡å é€»è¾‘æ··ä¹±
                        if (state.highlightedSidebarItems.size === 0 && Math.random() * 100 < highlightChance) {
                            highlightRandomDistraction();
                        }
                    }
                }, 2000 + Math.random() * 3000);
            }, 1500);
        }

        function handleDistractionClick(distractionElement) {
            if (!state.started) return;

            if (distractionElement.classList.contains('highlighted')) {
                distractionElement.classList.remove('highlighted');
                state.highlightedSidebarItems.delete(distractionElement.id);
                state.currentHighlighted = null;

                // åªæœ‰å½“æ²¡æœ‰å¹¿å‘Šé«˜äº®æ—¶ï¼Œæ‰ç§»é™¤æ–‡æœ¬æ¨¡ç³Š
                if (state.highlightedAds.size === 0) {
                    policyText.classList.remove('dimmed');
                    state.textDimmed = false;
                }

                state.distractionsClicked++;
                playFeedbackSound();
                state.chaosLevel = Math.max(0, state.chaosLevel - 8);

                updateInputState();
                updateVisuals();
            }
        }

        // --- å¹¿å‘Šç³»ç»Ÿ ---
        function startPopupAdSystem() {
            function spawnPopupAd() {
                if (!state.started) return;
                if (state.popupAds.length >= state.maxAds) return;

                const adData = popupAdsData[Math.floor(Math.random() * popupAdsData.length)];
                const adId = 'ad-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);

                const ad = document.createElement('div');
                ad.className = `popup-ad ad-type-${adData.type}`;
                ad.id = adId;

                // è·å–å¹¿å‘Šå°ºå¯¸
                let adWidth, adHeight;
                switch (adData.type) {
                    case 'standard': adWidth = 220; adHeight = 120; break;
                    case 'banner': adWidth = 300; adHeight = 60; break;
                    case 'circle': adWidth = 150; adHeight = 150; break;
                    case 'countdown': adWidth = 180; adHeight = 130; break;
                    case 'warning': adWidth = 250; adHeight = 120; break;
                    case 'notification': adWidth = 260; adHeight = 140; break;
                    case 'coupon': adWidth = 240; adHeight = 160; break;
                    default: adWidth = 200; adHeight = 100;
                }

                // ç”Ÿæˆå¹¿å‘Šå†…å®¹
                let adHTML = '';
                switch (adData.type) {
                    case 'standard':
                        adHTML = `<div class="popup-ad-close">Ã—</div><div class="distraction-title" style="color: ${adData.textColor};">${adData.title}</div><div class="distraction-content" style="color: ${adData.textColor};">${adData.content}</div>`;
                        break;
                    case 'banner':
                        adHTML = `<div class="popup-ad-close">Ã—</div><div style="font-size: 16px; font-weight: bold; color: ${adData.textColor};">${adData.title}</div><div style="font-size: 12px; color: ${adData.textColor};">${adData.content}</div>`;
                        break;
                    case 'circle':
                        adHTML = `<div class="popup-ad-close">Ã—</div><div style="font-size: 18px; margin-bottom: 5px; color: ${adData.textColor};">${adData.title}</div><div style="font-size: 12px; color: ${adData.textColor};">${adData.content}</div>`;
                        break;
                    case 'countdown':
                        adHTML = `<div class="popup-ad-close">Ã—</div><div class="distraction-title" style="color: ${adData.textColor};">${adData.title}</div><div class="distraction-content" style="color: ${adData.textColor};">${adData.content}</div>`;
                        break;
                    case 'warning':
                        adHTML = `<div class="popup-ad-close">Ã—</div><div style="font-size: 18px; margin-bottom: 10px; color: ${adData.textColor};">âš ï¸ ${adData.title}</div><div style="color: ${adData.textColor};">${adData.content}</div>`;
                        break;
                    case 'notification':
                        adHTML = `<div class="popup-ad-close">Ã—</div><div class="notification-icon">ğŸ””</div><div class="distraction-title" style="color: ${adData.textColor};">${adData.title}</div><div class="distraction-content" style="color: ${adData.textColor};">${adData.content}</div>`;
                        break;
                    case 'coupon':
                        adHTML = `<div class="popup-ad-close">Ã—</div><div class="distraction-title" style="color: ${adData.textColor};">${adData.title}</div><div class="coupon-code">${adData.couponCode || "CODE2024"}</div><div class="distraction-content" style="color: ${adData.textColor};">${adData.content}</div>`;
                        break;
                }

                ad.innerHTML = adHTML;
                ad.style.borderColor = adData.color;

                // è·å–ä¸»å®¹å™¨çš„ä½ç½®å’Œå¤§å°
                const containerRect = mainContainer.getBoundingClientRect();

                // åœ¨ä¸»å®¹å™¨å†…éšæœºç”Ÿæˆä½ç½®ï¼Œå¹¶ç•™å‡ºè¾¹è·
                const minX = 10;
                const minY = 10;
                const maxX = Math.max(0, containerRect.width - adWidth - 10);
                const maxY = Math.max(0, containerRect.height - adHeight - 10);

                // å¦‚æœä¸»å®¹å™¨å†…æ²¡æœ‰è¶³å¤Ÿç©ºé—´ï¼Œåˆ™ä¸ç”Ÿæˆå¹¿å‘Š
                if (maxX < minX || maxY < minY) return;

                // ç”Ÿæˆç›¸å¯¹ä¸»å®¹å™¨çš„éšæœºä½ç½®ï¼ˆä¿®å¤ï¼šä½¿ç”¨æ­£ç¡®çš„éšæœºå…¬å¼ï¼‰
                const randomX = minX + Math.floor(Math.random() * Math.max(1, maxX - minX));
                const randomY = minY + Math.floor(Math.random() * Math.max(1, maxY - minY));

                // è½¬æ¢ä¸ºç»å¯¹ä½ç½®ï¼ˆç›¸å¯¹äºé¡µé¢ï¼‰
                let absoluteX = containerRect.left + randomX;
                let absoluteY = containerRect.top + randomY;
                
                // é¢å¤–å®‰å…¨æ£€æŸ¥ï¼šç¡®ä¿å¹¿å‘Šåœ¨è§†å£å†…
                const viewportWidth = window.innerWidth;
                const viewportHeight = window.innerHeight;
                absoluteX = Math.max(10, Math.min(absoluteX, viewportWidth - adWidth - 10));
                absoluteY = Math.max(10, Math.min(absoluteY, viewportHeight - adHeight - 10));

                ad.style.left = `${absoluteX}px`;
                ad.style.top = `${absoluteY}px`;
                ad.style.position = 'fixed'; // ç¡®ä¿ä½¿ç”¨å›ºå®šå®šä½

                document.body.appendChild(ad);
                
                // æ·»åŠ åç«‹å³æ£€æŸ¥å®é™…ä½ç½®æ˜¯å¦åœ¨è§†å£å†…
                setTimeout(() => {
                    const rect = ad.getBoundingClientRect();
                    const isOutOfView = rect.right < 0 || rect.bottom < 0 || 
                                       rect.left > window.innerWidth || 
                                       rect.top > window.innerHeight;
                    
                    if (isOutOfView) {
                        console.warn("å¹¿å‘Šç”Ÿæˆåœ¨å±å¹•å¤–ï¼Œè‡ªåŠ¨ç§»é™¤");
                        ad.remove();
                        return;
                    }
                    
                    state.popupAds.push(ad);
                    ad.classList.add('active');
                }, 100);

                // å…³é—­æŒ‰é’®äº‹ä»¶
                const closeBtn = ad.querySelector('.popup-ad-close');
                if (closeBtn) {
                    closeBtn.addEventListener('click', function (e) {
                        e.stopPropagation();
                        removeAd(ad);
                    });
                }

                // ç‚¹å‡»å¹¿å‘Šäº‹ä»¶
                ad.addEventListener('click', function () {
                    handleAdClick(ad);
                });

                // éšæœºé«˜äº®
                const highlightDelay = 800 + Math.random() * 1200;
                const highlightTimer = setTimeout(() => {
                    if (state.started && ad.parentNode) {
                        const highlightChance = Math.min(80, 50 + (state.chaosLevel * 0.4));
                        if (Math.random() * 100 < highlightChance) {
                            highlightAd(ad);
                        }
                    }
                }, highlightDelay);
                state.adTimers.set(adId + '-highlight', highlightTimer);

                // è‡ªåŠ¨ç§»é™¤
                const autoRemoveTime = 6000 + Math.random() * 4000;
                const removeTimer = setTimeout(() => {
                    if (ad.parentNode) {
                        removeAd(ad);
                    }
                }, autoRemoveTime);
                state.adTimers.set(adId + '-remove', removeTimer);

                return adId;
            }

            function scheduleNextPopupAd() {
                if (!state.started) return;

                const spawnChance = Math.min(80, state.baseSpawnChance + (state.chaosLevel * 0.5));
                if (Math.random() * 100 < spawnChance) {
                    spawnPopupAd();
                }

                const nextInterval = Math.max(1000, state.spawnRateMs - (state.chaosLevel * 20)) * (0.6 + Math.random() * 0.8);
                setTimeout(scheduleNextPopupAd, nextInterval);
            }

            setTimeout(() => {
                spawnPopupAd();
                setTimeout(() => spawnPopupAd(), 800);
                scheduleNextPopupAd();
            }, 2000);
        }

        function highlightAd(adElement) {
            if (!state.started || !adElement.parentNode) return;

            adElement.classList.add('highlighted');
            state.highlightedAds.add(adElement.id);

            policyText.classList.add('dimmed');

            playHighlightSound();
            updateInputState();
        }

        function handleAdClick(adElement) {
            if (!state.started) return;

            if (adElement.classList.contains('highlighted')) {
                adElement.classList.remove('highlighted');
                // ç«‹å³ä»Setä¸­ç§»é™¤ï¼Œé˜²æ­¢å¹¶å‘é—®é¢˜
                state.highlightedAds.delete(adElement.id);

                // æ£€æŸ¥æ˜¯å¦è¿˜æœ‰å…¶ä»–å¹²æ‰°ï¼Œå¦‚æœæ²¡æœ‰åˆ™æ¢å¤æ–‡æœ¬
                if (state.highlightedSidebarItems.size === 0 && state.highlightedAds.size === 0) {
                    policyText.classList.remove('dimmed');
                }

                state.distractionsClicked++;
                playFeedbackSound();
                state.chaosLevel = Math.max(0, state.chaosLevel - 5);

                updateInputState();
                updateVisuals();
            }

            setTimeout(() => {
                removeAd(adElement);
            }, 300);
        }

        // --- ä¿®å¤åçš„ removeAd (å…³é”®é€»è¾‘) ---
        function removeAd(adElement) {
            if (!adElement || !adElement.parentNode) return;

            const adId = adElement.id;

            // ã€å…³é”®ä¿®å¤ã€‘ï¼šæ— æ¡ä»¶ä»é«˜äº®é›†åˆä¸­ç§»é™¤IDï¼Œæ— è®ºå®ƒå½“å‰æœ‰æ²¡æœ‰class
            // è¿™é˜²æ­¢äº†"DOMä¸­æ²¡æœ‰é«˜äº®æ ·å¼äº†ï¼Œä½†Seté‡Œè¿˜ç•™ç€ID"çš„æƒ…å†µ
            if (state.highlightedAds.has(adId)) {
                state.highlightedAds.delete(adId);
            }

            // ç¡®ä¿å¦‚æœæœ‰é«˜äº®æ ·å¼ï¼Œä¹Ÿç§»é™¤å®ƒï¼ˆè§†è§‰ä¸Šï¼‰
            if (adElement.classList.contains('highlighted')) {
                adElement.classList.remove('highlighted');
            }

            // å¦‚æœæ²¡æœ‰å…¶ä»–é«˜äº®äº†ï¼Œæ¢å¤æ–‡æœ¬
            if (state.highlightedAds.size === 0 && state.highlightedSidebarItems.size === 0) {
                policyText.classList.remove('dimmed');
            }

            updateInputState();

            adElement.classList.remove('active');
            setTimeout(() => {
                if (adElement.parentNode) {
                    adElement.remove();

                    const index = state.popupAds.indexOf(adElement);
                    if (index > -1) state.popupAds.splice(index, 1);

                    ['-highlight', '-remove'].forEach(suffix => {
                        const timerKey = adId + suffix;
                        const timerId = state.adTimers.get(timerKey);
                        if (timerId) {
                            clearTimeout(timerId);
                            state.adTimers.delete(timerKey);
                        }
                    });
                }
            }, 300);
        }

        // --- æ··ä¹±å¼•æ“ ---
        function updateVisuals() {
            if (whiteNoiseGain) {
                whiteNoiseGain.gain.setTargetAtTime(0.02 + (state.chaosLevel / 2000), audioCtx.currentTime, 0.5);
            }
            state.spawnRateMs = Math.max(1200, 2500 - (state.chaosLevel * 25));
        }

        // --- éŸ³é¢‘ç³»ç»Ÿ ---
        function initAudio() {
            const AudioContext = window.AudioContext || window.webkitAudioContext;
            audioCtx = new AudioContext();

            const bufferSize = 2 * audioCtx.sampleRate;
            const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate);
            const output = noiseBuffer.getChannelData(0);
            for (let i = 0; i < bufferSize; i++) { output[i] = Math.random() * 2 - 1; }
            const whiteNoise = audioCtx.createBufferSource();
            whiteNoise.buffer = noiseBuffer;
            whiteNoise.loop = true;
            whiteNoiseGain = audioCtx.createGain();
            whiteNoiseGain.gain.value = 0.02;
            whiteNoise.connect(whiteNoiseGain).connect(audioCtx.destination);
            whiteNoise.start();
        }

        function playHighlightSound() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'square';
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.15, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.3);
            osc.connect(gain).connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        function playBlockedSound() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sawtooth';
            osc.frequency.setValueAtTime(300, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2);
            osc.connect(gain).connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.2);
        }

        function playFeedbackSound() {
            if (!audioCtx) return;
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.type = 'sine';
            osc.frequency.setValueAtTime(600, audioCtx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(1200, audioCtx.currentTime + 0.1);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + 0.2);
            osc.connect(gain).connect(audioCtx.destination);
            osc.start();
            osc.stop(audioCtx.currentTime + 0.2);
        }

        // æ·»åŠ æŠ–åŠ¨åŠ¨ç”»
        const style = document.createElement('style');
        style.textContent = `
                            @keyframes shake {
                                0%, 100% { transform: translateX(0); }
                                10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
                                20%, 40%, 60%, 80% { transform: translateX(5px); }
                            }
                        `;
        document.head.appendChild(style);
    </script>
</body>
</html>